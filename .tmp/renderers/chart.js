(function(e){typeof define=="function"&&define.amd?define("jstree",["jquery"],e):typeof exports=="object"?e(require("jquery")):e(jQuery)})(function(e,t){if(e.jstree)return;var n=0,r=!1,i=!1,s=!1,o=[],u=e("script:last").attr("src"),a=document,f=a.createElement("LI"),l,c;f.setAttribute("role","treeitem"),l=a.createElement("I"),l.className="jstree-icon jstree-ocl",f.appendChild(l),l=a.createElement("A"),l.className="jstree-anchor",l.setAttribute("href","#"),c=a.createElement("I"),c.className="jstree-icon jstree-themeicon",l.appendChild(c),f.appendChild(l),l=c=null,e.jstree={version:"3.0.2",defaults:{plugins:[]},plugins:{},path:u&&u.indexOf("/")!==-1?u.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}]/g},e.jstree.create=function(t,r){var i=new e.jstree.core(++n),s=r;return r=e.extend(!0,{},e.jstree.defaults,r),s&&s.plugins&&(r.plugins=s.plugins),e.each(r.plugins,function(e,t){e!=="core"&&(i=i.plugin(t,r[t]))}),i.init(t,r),i},e.jstree.core=function(e){this._id=e,this._cnt=0,this._wrk=null,this._data={core:{themes:{name:!1,dots:!1,icons:!1},selected:[],last_error:{}}}},e.jstree.reference=function(t){var n=null,r=null;t&&t.id&&(t=t.id);if(!r||!r.length)try{r=e(t)}catch(i){}if(!r||!r.length)try{r=e("#"+t.replace(e.jstree.idregex,"\\$&"))}catch(i){}return r&&r.length&&(r=r.closest(".jstree")).length&&(r=r.data("jstree"))?n=r:e(".jstree").each(function(){var r=e(this).data("jstree");if(r&&r._model.data[t])return n=r,!1}),n},e.fn.jstree=function(n){var r=typeof n=="string",i=Array.prototype.slice.call(arguments,1),s=null;return this.each(function(){var o=e.jstree.reference(this),u=r&&o?o[n]:null;s=r&&u?u.apply(o,i):null,!o&&!r&&(n===t||e.isPlainObject(n))&&e(this).data("jstree",new e.jstree.create(this,n));if(o&&!r||n===!0)s=o||!1;if(s!==null&&s!==t)return!1}),s!==null&&s!==t?s:this},e.expr[":"].jstree=e.expr.createPseudo(function(n){return function(n){return e(n).hasClass("jstree")&&e(n).data("jstree")!==t}}),e.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:e.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0},e.jstree.core.prototype={plugin:function(t,n){var r=e.jstree.plugins[t];return r?(this._data[t]={},r.prototype=this,new r(n,this)):this},init:function(t,n){this._model={data:{"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}}},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}},this.element=e(t).addClass("jstree jstree-"+this._id),this.settings=n,this.element.bind("destroyed",e.proxy(this.teardown,this)),this._data.core.ready=!1,this._data.core.loaded=!1,this._data.core.rtl=this.element.css("direction")==="rtl",this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl"),this.element.attr("role","tree"),this.bind(),this.trigger("init"),this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0),this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return this.nodeType===3&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove(),this.element.html("<ul class='jstree-container-ul jstree-children'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this._data.core.li_height=this.get_container_ul().children("li:eq(0)").height()||24,this.trigger("loading"),this.load_node("#")},destroy:function(e){e||this.element.empty(),this.element.unbind("destroyed",this.teardown),this.teardown()},teardown:function(){this.unbind(),this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/ig,"")}),this.element=null},bind:function(){this.element.on("dblclick.jstree",function(){if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){var e=window.getSelection();try{e.removeAllRanges(),e.collapse()}catch(t){}}}).on("click.jstree",".jstree-ocl",e.proxy(function(e){this.toggle_node(e.target)},this)).on("click.jstree",".jstree-anchor",e.proxy(function(t){t.preventDefault(),e(t.currentTarget).focus(),this.activate_node(t.currentTarget,t)},this)).on("keydown.jstree",".jstree-anchor",e.proxy(function(t){if(t.target.tagName==="INPUT")return!0;var n=null;switch(t.which){case 13:case 32:t.type="click",e(t.currentTarget).trigger(t);break;case 37:t.preventDefault(),this.is_open(t.currentTarget)?this.close_node(t.currentTarget):(n=this.get_prev_dom(t.currentTarget),n&&n.length&&n.children(".jstree-anchor").focus());break;case 38:t.preventDefault(),n=this.get_prev_dom(t.currentTarget),n&&n.length&&n.children(".jstree-anchor").focus();break;case 39:t.preventDefault(),this.is_closed(t.currentTarget)?this.open_node(t.currentTarget,function(e){this.get_node(e,!0).children(".jstree-anchor").focus()}):(n=this.get_next_dom(t.currentTarget),n&&n.length&&n.children(".jstree-anchor").focus());break;case 40:t.preventDefault(),n=this.get_next_dom(t.currentTarget),n&&n.length&&n.children(".jstree-anchor").focus();break;case 46:t.preventDefault(),n=this.get_node(t.currentTarget),n&&n.id&&n.id!=="#"&&(n=this.is_selected(n)?this.get_selected():n);break;case 113:t.preventDefault(),n=this.get_node(t.currentTarget);break;default:}},this)).on("load_node.jstree",e.proxy(function(t,n){if(n.status){n.node.id==="#"&&!this._data.core.loaded&&(this._data.core.loaded=!0,this.trigger("loaded"));if(!this._data.core.ready&&!this.get_container_ul().find(".jstree-loading:eq(0)").length){this._data.core.ready=!0;if(this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var r=[],i,s;for(i=0,s=this._data.core.selected.length;i<s;i++)r=r.concat(this._model.data[this._data.core.selected[i]].parents);r=e.vakata.array_unique(r);for(i=0,s=r.length;i<s;i++)this.open_node(r[i],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}setTimeout(e.proxy(function(){this.trigger("ready")},this),0)}}},this)).on("init.jstree",e.proxy(function(){var e=this.settings.core.themes;this._data.core.themes.dots=e.dots,this._data.core.themes.stripes=e.stripes,this._data.core.themes.icons=e.icons,this.set_theme(e.name||"default",e.url),this.set_theme_variant(e.variant)},this)).on("loading.jstree",e.proxy(function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"](),this[this._data.core.themes.icons?"show_icons":"hide_icons"](),this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]()},this)).on("blur.jstree",".jstree-anchor",e.proxy(function(t){e(t.currentTarget).filter(".jstree-hovered").mouseleave()},this)).on("focus.jstree",".jstree-anchor",e.proxy(function(t){this.element.find(".jstree-hovered").not(t.currentTarget).mouseleave(),e(t.currentTarget).mouseenter()},this)).on("mouseenter.jstree",".jstree-anchor",e.proxy(function(e){this.hover_node(e.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},unbind:function(){this.element.off(".jstree"),e(document).off(".jstree-"+this._id)},trigger:function(e,t){t||(t={}),t.instance=this,this.element.triggerHandler(e.replace(".jstree","")+".jstree",t)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children:eq(0)")},get_string:function(t){var n=this.settings.core.strings;return e.isFunction(n)?n.call(this,t):n&&n[t]?n[t]:t},_firstChild:function(e){e=e?e.firstChild:null;while(e!==null&&e.nodeType!==1)e=e.nextSibling;return e},_nextSibling:function(e){e=e?e.nextSibling:null;while(e!==null&&e.nodeType!==1)e=e.nextSibling;return e},_previousSibling:function(e){e=e?e.previousSibling:null;while(e!==null&&e.nodeType!==1)e=e.previousSibling;return e},get_node:function(t,n){t&&t.id&&(t=t.id);var r;try{if(this._model.data[t])t=this._model.data[t];else if(((r=e(t,this.element)).length||(r=e("#"+t.replace(e.jstree.idregex,"\\$&"),this.element)).length)&&this._model.data[r.closest(".jstree-node").attr("id")])t=this._model.data[r.closest(".jstree-node").attr("id")];else{if(!(r=e(t,this.element)).length||!r.hasClass("jstree"))return!1;t=this._model.data["#"]}return n&&(t=t.id==="#"?this.element:e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)),t}catch(i){return!1}},get_path:function(e,t,n){e=e.parents?e:this.get_node(e);if(!e||e.id==="#"||!e.parents)return!1;var r,i,s=[];s.push(n?e.id:e.text);for(r=0,i=e.parents.length;r<i;r++)s.push(n?e.parents[r]:this.get_text(e.parents[r]));return s=s.reverse().slice(1),t?s.join(t):s},get_next_dom:function(t,n){var r;return t=this.get_node(t,!0),t[0]===this.element[0]?(r=this._firstChild(this.get_container_ul()[0]),r?e(r):!1):!t||!t.length?!1:n?(r=this._nextSibling(t[0]),r?e(r):!1):t.hasClass("jstree-open")?(r=this._firstChild(t.children(".jstree-children")[0]),r?e(r):!1):(r=this._nextSibling(t[0]))!==null?e(r):t.parentsUntil(".jstree",".jstree-node").next(".jstree-node").eq(0)},get_prev_dom:function(t,n){var r;t=this.get_node(t,!0);if(t[0]===this.element[0])return r=this.get_container_ul()[0].lastChild,r?e(r):!1;if(!t||!t.length)return!1;if(n)return r=this._previousSibling(t[0]),r?e(r):!1;if((r=this._previousSibling(t[0]))!==null){t=e(r);while(t.hasClass("jstree-open"))t=t.children(".jstree-children:eq(0)").children(".jstree-node:last");return t}return r=t[0].parentNode.parentNode,r&&r.className&&r.className.indexOf("jstree-node")!==-1?e(r):!1},get_parent:function(e){return e=this.get_node(e),!e||e.id==="#"?!1:e.parent},get_children_dom:function(e){return e=this.get_node(e,!0),e[0]===this.element[0]?this.get_container_ul().children(".jstree-node"):!e||!e.length?!1:e.children(".jstree-children").children(".jstree-node")},is_parent:function(e){return e=this.get_node(e),e&&(e.state.loaded===!1||e.children.length>0)},is_loaded:function(e){return e=this.get_node(e),e&&e.state.loaded},is_loading:function(e){return e=this.get_node(e),e&&e.state&&e.state.loading},is_open:function(e){return e=this.get_node(e),e&&e.state.opened},is_closed:function(e){return e=this.get_node(e),e&&this.is_parent(e)&&!e.state.opened},is_leaf:function(e){return!this.is_parent(e)},load_node:function(t,n){var r,i,s,o,u;if(e.isArray(t))return this._load_nodes(t.slice(),n),!0;t=this.get_node(t);if(!t)return n&&n.call(this,t,!1),!1;if(t.state.loaded){t.state.loaded=!1;for(r=0,i=t.children_d.length;r<i;r++){for(s=0,o=t.parents.length;s<o;s++)this._model.data[t.parents[s]].children_d=e.vakata.array_remove_item(this._model.data[t.parents[s]].children_d,t.children_d[r]);this._model.data[t.children_d[r]].state.selected&&(u=!0,this._data.core.selected=e.vakata.array_remove_item(this._data.core.selected,t.children_d[r])),delete this._model.data[t.children_d[r]]}t.children=[],t.children_d=[],u&&this.trigger("changed",{action:"load_node",node:t,selected:this._data.core.selected})}return t.state.loading=!0,this.get_node(t,!0).addClass("jstree-loading"),this._load_node(t,e.proxy(function(e){t=this._model.data[t.id],t.state.loading=!1,t.state.loaded=e;var r=this.get_node(t,!0);t.state.loaded&&!t.children.length&&r&&r.length&&!r.hasClass("jstree-leaf")&&r.removeClass("jstree-closed jstree-open").addClass("jstree-leaf"),r.removeClass("jstree-loading"),this.trigger("load_node",{node:t,status:e}),n&&n.call(this,t,e)},this)),!0},_load_nodes:function(e,t,n){var r=!0,i=function(){this._load_nodes(e,t,!0)},s=this._model.data,o,u;for(o=0,u=e.length;o<u;o++)s[e[o]]&&(!s[e[o]].state.loaded||!n)&&(this.is_loading(e[o])||this.load_node(e[o],i),r=!1);r&&(t.done||(t.call(this,e),t.done=!0))},_load_node:function(t,n){var r=this.settings.core.data,i;return r?e.isFunction(r)?r.call(this,t,e.proxy(function(r){r===!1&&n.call(this,!1),this[typeof r=="string"?"_append_html_data":"_append_json_data"](t,typeof r=="string"?e(r):r,function(e){n.call(this,e)})},this)):typeof r=="object"?r.url?(r=e.extend(!0,{},r),e.isFunction(r.url)&&(r.url=r.url.call(this,t)),e.isFunction(r.data)&&(r.data=r.data.call(this,t)),e.ajax(r).done(e.proxy(function(r,i,s){var o=s.getResponseHeader("Content-Type");return o.indexOf("json")!==-1||typeof r=="object"?this._append_json_data(t,r,function(e){n.call(this,e)}):o.indexOf("html")!==-1||typeof r=="string"?this._append_html_data(t,e(r),function(e){n.call(this,e)}):(this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:s})},this.settings.core.error.call(this,this._data.core.last_error),n.call(this,!1))},this)).fail(e.proxy(function(e){n.call(this,!1),this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:e})},this.settings.core.error.call(this,this._data.core.last_error)},this))):(i=e.isArray(r)||e.isPlainObject(r)?JSON.parse(JSON.stringify(r)):r,t.id==="#"?this._append_json_data(t,i,function(e){n.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),n.call(this,!1))):typeof r=="string"?t.id==="#"?this._append_html_data(t,e(r),function(e){n.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),n.call(this,!1)):n.call(this,!1):t.id==="#"?this._append_html_data(t,this._data.core.original_container_html.clone(!0),function(e){n.call(this,e)}):n.call(this,!1)},_node_changed:function(e){e=this.get_node(e),e&&this._model.changed.push(e.id)},_append_html_data:function(t,n,r){t=this.get_node(t),t.children=[],t.children_d=[];var i=n.is("ul")?n.children():n,s=t.id,o=[],u=[],a=this._model.data,f=a[s],l=this._data.core.selected.length,c,h,p;i.each(e.proxy(function(t,n){c=this._parse_model_from_html(e(n),s,f.parents.concat()),c&&(o.push(c),u.push(c),a[c].children_d.length&&(u=u.concat(a[c].children_d)))},this)),f.children=o,f.children_d=u;for(h=0,p=f.parents.length;h<p;h++)a[f.parents[h]].children_d=a[f.parents[h]].children_d.concat(u);this.trigger("model",{nodes:u,parent:s}),s!=="#"?(this._node_changed(s),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0)),this._data.core.selected.length!==l&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),r.call(this,!0)},_append_json_data:function(t,n,r){t=this.get_node(t),t.children=[],t.children_d=[],n.d&&(n=n.d,typeof n=="string"&&(n=JSON.parse(n))),e.isArray(n)||(n=[n]);var i=null,s={df:this._model.default_state,dat:n,par:t.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},o=function(e,t){e.data&&(e=e.data);var n=e.dat,r=e.par,i=[],s=[],o=[],u=e.df,a=e.t_id,f=e.t_cnt,l=e.m,c=l[r],h=e.sel,p,d,v,m,g=function(e,n,r){r?r=r.concat():r=[],n&&r.unshift(n);var i=e.id.toString(),s,a,f,c,h={id:i,text:e.text||"",icon:e.icon!==t?e.icon:!0,parent:n,parents:r,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in u)u.hasOwnProperty(s)&&(h.state[s]=u[s]);e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(h.icon=e.data.jstree.icon);if(e&&e.data){h.data=e.data;if(e.data.jstree)for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(h.state[s]=e.data.jstree[s])}if(e&&typeof e.state=="object")for(s in e.state)e.state.hasOwnProperty(s)&&(h.state[s]=e.state[s]);if(e&&typeof e.li_attr=="object")for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(h.li_attr[s]=e.li_attr[s]);h.li_attr.id||(h.li_attr.id=i);if(e&&typeof e.a_attr=="object")for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(h.a_attr[s]=e.a_attr[s]);e&&e.children&&e.children===!0&&(h.state.loaded=!1,h.children=[],h.children_d=[]),l[h.id]=h;for(s=0,a=h.children.length;s<a;s++)f=g(l[h.children[s]],h.id,r),c=l[f],h.children_d.push(f),c.children_d.length&&(h.children_d=h.children_d.concat(c.children_d));return delete e.data,delete e.children,l[h.id].original=e,h.state.selected&&o.push(h.id),h.id},y=function(e,n,r){r?r=r.concat():r=[],n&&r.unshift(n);var i=!1,s,c,h,p,d;do i="j"+a+"_"+ ++f;while(l[i]);d={id:!1,text:typeof e=="string"?e:"",icon:typeof e=="object"&&e.icon!==t?e.icon:!0,parent:n,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in u)u.hasOwnProperty(s)&&(d.state[s]=u[s]);e&&e.id&&(d.id=e.id.toString()),e&&e.text&&(d.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(d.icon=e.data.jstree.icon);if(e&&e.data){d.data=e.data;if(e.data.jstree)for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(d.state[s]=e.data.jstree[s])}if(e&&typeof e.state=="object")for(s in e.state)e.state.hasOwnProperty(s)&&(d.state[s]=e.state[s]);if(e&&typeof e.li_attr=="object")for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(d.li_attr[s]=e.li_attr[s]);d.li_attr.id&&!d.id&&(d.id=d.li_attr.id.toString()),d.id||(d.id=i),d.li_attr.id||(d.li_attr.id=d.id);if(e&&typeof e.a_attr=="object")for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(d.a_attr[s]=e.a_attr[s]);if(e&&e.children&&e.children.length){for(s=0,c=e.children.length;s<c;s++)h=y(e.children[s],d.id,r),p=l[h],d.children.push(h),p.children_d.length&&(d.children_d=d.children_d.concat(p.children_d));d.children_d=d.children_d.concat(d.children)}return e&&e.children&&e.children===!0&&(d.state.loaded=!1,d.children=[],d.children_d=[]),delete e.data,delete e.children,d.original=e,l[d.id]=d,d.state.selected&&o.push(d.id),d.id};if(n.length&&n[0].id!==t&&n[0].parent!==t){for(d=0,v=n.length;d<v;d++)n[d].children||(n[d].children=[]),l[n[d].id.toString()]=n[d];for(d=0,v=n.length;d<v;d++)l[n[d].parent.toString()].children.push(n[d].id.toString()),c.children_d.push(n[d].id.toString());for(d=0,v=c.children.length;d<v;d++)p=g(l[c.children[d]],r,c.parents.concat()),s.push(p),l[p].children_d.length&&(s=s.concat(l[p].children_d));m={cnt:f,mod:l,sel:h,par:r,dpc:s,add:o}}else{for(d=0,v=n.length;d<v;d++)p=y(n[d],r,c.parents.concat()),p&&(i.push(p),s.push(p),l[p].children_d.length&&(s=s.concat(l[p].children_d)));c.children=i,c.children_d=s;for(d=0,v=c.parents.length;d<v;d++)l[c.parents[d]].children_d=l[c.parents[d]].children_d.concat(s);m={cnt:f,mod:l,sel:h,par:r,dpc:s,add:o}}return m},u=function(t,n){this._cnt=t.cnt,this._model.data=t.mod;if(n){var i,s,o=t.add,u=t.sel,a=this._data.core.selected.slice(),f=this._model.data;if(u.length!==a.length||e.vakata.array_unique(u.concat(a)).length!==u.length){for(i=0,s=u.length;i<s;i++)e.inArray(u[i],o)===-1&&e.inArray(u[i],a)===-1&&(f[u[i]].state.selected=!1);for(i=0,s=a.length;i<s;i++)e.inArray(a[i],u)===-1&&(f[a[i]].state.selected=!0)}}t.add.length&&(this._data.core.selected=this._data.core.selected.concat(t.add)),this.trigger("model",{nodes:t.dpc,parent:t.par}),t.par!=="#"?(this._node_changed(t.par),this.redraw()):this.redraw(!0),t.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),r.call(this,!0)};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{this._wrk===null&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+o.toString().replace(/return ([^;}]+)[\s;}]+$/,"postMessage($1);}")],{type:"text/javascript"}))),i=new window.Worker(this._wrk),i.onmessage=e.proxy(function(e){u.call(this,e.data,!0)},this),i.postMessage(s)}catch(a){u.call(this,o(s),!1)}else u.call(this,o(s),!1)},_parse_model_from_html:function(t,n,r){r?r=[].concat(r):r=[],n&&r.unshift(n);var i,s,o=this._model.data,u={id:!1,text:!1,icon:!0,parent:n,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1},a,f,l;for(a in this._model.default_state)this._model.default_state.hasOwnProperty(a)&&(u.state[a]=this._model.default_state[a]);f=e.vakata.attributes(t,!0),e.each(f,function(t,n){n=e.trim(n);if(!n.length)return!0;u.li_attr[t]=n,t==="id"&&(u.id=n.toString())}),f=t.children("a").eq(0),f.length&&(f=e.vakata.attributes(f,!0),e.each(f,function(t,n){n=e.trim(n),n.length&&(u.a_attr[t]=n)})),f=t.children("a:eq(0)").length?t.children("a:eq(0)").clone():t.clone(),f.children("ins, i, ul").remove(),f=f.html(),f=e("<div />").html(f),u.text=f.html(),f=t.data(),u.data=f?e.extend(!0,{},f):null,u.state.opened=t.hasClass("jstree-open"),u.state.selected=t.children("a").hasClass("jstree-clicked"),u.state.disabled=t.children("a").hasClass("jstree-disabled");if(u.data&&u.data.jstree)for(a in u.data.jstree)u.data.jstree.hasOwnProperty(a)&&(u.state[a]=u.data.jstree[a]);f=t.children("a").children(".jstree-themeicon"),f.length&&(u.icon=f.hasClass("jstree-themeicon-hidden")?!1:f.attr("rel")),u.state.icon&&(u.icon=u.state.icon),f=t.children("ul").children("li");do l="j"+this._id+"_"+ ++this._cnt;while(o[l]);return u.id=u.li_attr.id?u.li_attr.id.toString():l,f.length?(f.each(e.proxy(function(t,n){i=this._parse_model_from_html(e(n),u.id,r),s=this._model.data[i],u.children.push(i),s.children_d.length&&(u.children_d=u.children_d.concat(s.children_d))},this)),u.children_d=u.children_d.concat(u.children)):t.hasClass("jstree-closed")&&(u.state.loaded=!1),u.li_attr["class"]&&(u.li_attr["class"]=u.li_attr["class"].replace("jstree-closed","").replace("jstree-open","")),u.a_attr["class"]&&(u.a_attr["class"]=u.a_attr["class"].replace("jstree-clicked","").replace("jstree-disabled","")),o[u.id]=u,u.state.selected&&this._data.core.selected.push(u.id),u.id},_parse_model_from_flat_json:function(e,n,r){r?r=r.concat():r=[],n&&r.unshift(n);var i=e.id.toString(),s=this._model.data,o=this._model.default_state,u,a,f,l,c={id:i,text:e.text||"",icon:e.icon!==t?e.icon:!0,parent:n,parents:r,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(u in o)o.hasOwnProperty(u)&&(c.state[u]=o[u]);e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(c.icon=e.data.jstree.icon);if(e&&e.data){c.data=e.data;if(e.data.jstree)for(u in e.data.jstree)e.data.jstree.hasOwnProperty(u)&&(c.state[u]=e.data.jstree[u])}if(e&&typeof e.state=="object")for(u in e.state)e.state.hasOwnProperty(u)&&(c.state[u]=e.state[u]);if(e&&typeof e.li_attr=="object")for(u in e.li_attr)e.li_attr.hasOwnProperty(u)&&(c.li_attr[u]=e.li_attr[u]);c.li_attr.id||(c.li_attr.id=i);if(e&&typeof e.a_attr=="object")for(u in e.a_attr)e.a_attr.hasOwnProperty(u)&&(c.a_attr[u]=e.a_attr[u]);e&&e.children&&e.children===!0&&(c.state.loaded=!1,c.children=[],c.children_d=[]),s[c.id]=c;for(u=0,a=c.children.length;u<a;u++)f=this._parse_model_from_flat_json(s[c.children[u]],c.id,r),l=s[f],c.children_d.push(f),l.children_d.length&&(c.children_d=c.children_d.concat(l.children_d));return delete e.data,delete e.children,s[c.id].original=e,c.state.selected&&this._data.core.selected.push(c.id),c.id},_parse_model_from_json:function(e,n,r){r?r=r.concat():r=[],n&&r.unshift(n);var i=!1,s,o,u,a,f=this._model.data,l=this._model.default_state,c;do i="j"+this._id+"_"+ ++this._cnt;while(f[i]);c={id:!1,text:typeof e=="string"?e:"",icon:typeof e=="object"&&e.icon!==t?e.icon:!0,parent:n,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in l)l.hasOwnProperty(s)&&(c.state[s]=l[s]);e&&e.id&&(c.id=e.id.toString()),e&&e.text&&(c.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(c.icon=e.data.jstree.icon);if(e&&e.data){c.data=e.data;if(e.data.jstree)for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(c.state[s]=e.data.jstree[s])}if(e&&typeof e.state=="object")for(s in e.state)e.state.hasOwnProperty(s)&&(c.state[s]=e.state[s]);if(e&&typeof e.li_attr=="object")for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(c.li_attr[s]=e.li_attr[s]);c.li_attr.id&&!c.id&&(c.id=c.li_attr.id.toString()),c.id||(c.id=i),c.li_attr.id||(c.li_attr.id=c.id);if(e&&typeof e.a_attr=="object")for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(c.a_attr[s]=e.a_attr[s]);if(e&&e.children&&e.children.length){for(s=0,o=e.children.length;s<o;s++)u=this._parse_model_from_json(e.children[s],c.id,r),a=f[u],c.children.push(u),a.children_d.length&&(c.children_d=c.children_d.concat(a.children_d));c.children_d=c.children_d.concat(c.children)}return e&&e.children&&e.children===!0&&(c.state.loaded=!1,c.children=[],c.children_d=[]),delete e.data,delete e.children,c.original=e,f[c.id]=c,c.state.selected&&this._data.core.selected.push(c.id),c.id},_redraw:function(){var e=this._model.force_full_redraw?this._model.data["#"].children.concat([]):this._model.changed.concat([]),t=document.createElement("UL"),n,r,i;for(r=0,i=e.length;r<i;r++)n=this.redraw_node(e[r],!0,this._model.force_full_redraw),n&&this._model.force_full_redraw&&t.appendChild(n);this._model.force_full_redraw&&(t.className=this.get_container_ul()[0].className,this.element.empty().append(t)),this._model.force_full_redraw=!1,this._model.changed=[],this.trigger("redraw",{nodes:e})},redraw:function(e){e&&(this._model.force_full_redraw=!0),this._redraw()},redraw_node:function(t,n,r){var i=this.get_node(t),s=!1,o=!1,u=!1,a=!1,l=!1,c=!1,h="",p=document,d=this._model.data,v=!1,m=!1,g=null;if(!i)return!1;if(i.id==="#")return this.redraw(!0);n=n||i.children.length===0,t=document.querySelector?this.element[0].querySelector("#"+("0123456789".indexOf(i.id[0])!==-1?"\\3"+i.id[0]+" "+i.id.substr(1).replace(e.jstree.idregex,"\\$&"):i.id.replace(e.jstree.idregex,"\\$&"))):document.getElementById(i.id);if(!t){n=!0;if(!r){s=i.parent!=="#"?e("#"+i.parent.replace(e.jstree.idregex,"\\$&"),this.element)[0]:null;if(s!==null&&(!s||!d[i.parent].state.opened))return!1;o=e.inArray(i.id,s===null?d["#"].children:d[i.parent].children)}}else t=e(t),r||(s=t.parent().parent()[0],s===this.element[0]&&(s=null),o=t.index()),!n&&i.children.length&&!t.children(".jstree-children").length&&(n=!0),n||(u=t.children(".jstree-children")[0]),m=t.attr("aria-selected"),v=t.children(".jstree-anchor")[0]===document.activeElement,t.remove();t=f.cloneNode(!0),h="jstree-node ";for(a in i.li_attr)if(i.li_attr.hasOwnProperty(a)){if(a==="id")continue;a!=="class"?t.setAttribute(a,i.li_attr[a]):h+=i.li_attr[a]}m&&m!=="false"&&t.setAttribute("aria-selected",!0),i.state.loaded&&!i.children.length?h+=" jstree-leaf":(h+=i.state.opened&&i.state.loaded?" jstree-open":" jstree-closed",t.setAttribute("aria-expanded",i.state.opened&&i.state.loaded)),i.parent!==null&&d[i.parent].children[d[i.parent].children.length-1]===i.id&&(h+=" jstree-last"),t.id=i.id,t.className=h,h=(i.state.selected?" jstree-clicked":"")+(i.state.disabled?" jstree-disabled":"");for(l in i.a_attr)if(i.a_attr.hasOwnProperty(l)){if(l==="href"&&i.a_attr[l]==="#")continue;l!=="class"?t.childNodes[1].setAttribute(l,i.a_attr[l]):h+=" "+i.a_attr[l]}h.length&&(t.childNodes[1].className="jstree-anchor "+h);if(i.icon&&i.icon!==!0||i.icon===!1)i.icon===!1?t.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":i.icon.indexOf("/")===-1&&i.icon.indexOf(".")===-1?t.childNodes[1].childNodes[0].className+=" "+i.icon+" jstree-themeicon-custom":(t.childNodes[1].childNodes[0].style.backgroundImage="url("+i.icon+")",t.childNodes[1].childNodes[0].style.backgroundPosition="center center",t.childNodes[1].childNodes[0].style.backgroundSize="auto",t.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom");t.childNodes[1].innerHTML+=i.text;if(n&&i.children.length&&i.state.opened&&i.state.loaded){c=p.createElement("UL"),c.setAttribute("role","group"),c.className="jstree-children";for(a=0,l=i.children.length;a<l;a++)c.appendChild(this.redraw_node(i.children[a],n,!0));t.appendChild(c)}u&&t.appendChild(u);if(!r){s||(s=this.element[0]);for(a=0,l=s.childNodes.length;a<l;a++)if(s.childNodes[a]&&s.childNodes[a].className&&s.childNodes[a].className.indexOf("jstree-children")!==-1){g=s.childNodes[a];break}g||(g=p.createElement("UL"),g.setAttribute("role","group"),g.className="jstree-children",s.appendChild(g)),s=g,o<s.childNodes.length?s.insertBefore(t,s.childNodes[o]):s.appendChild(t),v&&t.childNodes[1].focus()}return i.state.opened&&!i.state.loaded&&(i.state.opened=!1,setTimeout(e.proxy(function(){this.open_node(i.id,!1,0)},this),0)),t},open_node:function(n,r,i){var s,o,u,a;if(e.isArray(n)){n=n.slice();for(s=0,o=n.length;s<o;s++)this.open_node(n[s],r,i);return!0}n=this.get_node(n);if(!n||n.id==="#")return!1;i=i===t?this.settings.core.animation:i;if(!this.is_closed(n))return r&&r.call(this,n,!1),!1;if(!this.is_loaded(n)){if(this.is_loading(n))return setTimeout(e.proxy(function(){this.open_node(n,r,i)},this),500);this.load_node(n,function(e,t){return t?this.open_node(e,r,i):r?r.call(this,e,!1):!1})}else u=this.get_node(n,!0),a=this,u.length&&(n.children.length&&!this._firstChild(u.children(".jstree-children")[0])&&(n.state.opened=!0,this.redraw_node(n,!0),u=this.get_node(n,!0)),i?(this.trigger("before_open",{node:n}),u.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",!0).children(".jstree-children").stop(!0,!0).slideDown(i,function(){this.style.display="",a.trigger("after_open",{node:n})})):(this.trigger("before_open",{node:n}),u[0].className=u[0].className.replace("jstree-closed","jstree-open"),u[0].setAttribute("aria-expanded",!0))),n.state.opened=!0,r&&r.call(this,n,!0),u.length||this.trigger("before_open",{node:n}),this.trigger("open_node",{node:n}),(!i||!u.length)&&this.trigger("after_open",{node:n})},_open_to:function(t){t=this.get_node(t);if(!t||t.id==="#")return!1;var n,r,i=t.parents;for(n=0,r=i.length;n<r;n+=1)n!=="#"&&this.open_node(i[n],!1,0);return e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)},close_node:function(n,r){var i,s,o,u;if(e.isArray(n)){n=n.slice();for(i=0,s=n.length;i<s;i++)this.close_node(n[i],r);return!0}n=this.get_node(n);if(!n||n.id==="#")return!1;if(this.is_closed(n))return!1;r=r===t?this.settings.core.animation:r,o=this,u=this.get_node(n,!0),u.length&&(r?u.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",!1).children(".jstree-children").stop(!0,!0).slideUp(r,function(){this.style.display="",u.children(".jstree-children").remove(),o.trigger("after_close",{node:n})}):(u[0].className=u[0].className.replace("jstree-open","jstree-closed"),u.attr("aria-expanded",!1).children(".jstree-children").remove())),n.state.opened=!1,this.trigger("close_node",{node:n}),(!r||!u.length)&&this.trigger("after_close",{node:n})},toggle_node:function(t){var n,r;if(e.isArray(t)){t=t.slice();for(n=0,r=t.length;n<r;n++)this.toggle_node(t[n]);return!0}if(this.is_closed(t))return this.open_node(t);if(this.is_open(t))return this.close_node(t)},open_all:function(e,t,n){e||(e="#"),e=this.get_node(e);if(!e)return!1;var r=e.id==="#"?this.get_container_ul():this.get_node(e,!0),i,s,o;if(!r.length){for(i=0,s=e.children_d.length;i<s;i++)this.is_closed(this._model.data[e.children_d[i]])&&(this._model.data[e.children_d[i]].state.opened=!0);return this.trigger("open_all",{node:e})}n=n||r,o=this,r=this.is_closed(e)?r.find(".jstree-closed").addBack():r.find(".jstree-closed"),r.each(function(){o.open_node(this,function(e,r){r&&this.is_parent(e)&&this.open_all(e,t,n)},t||0)}),n.find(".jstree-closed").length===0&&this.trigger("open_all",{node:this.get_node(n)})},close_all:function(t,n){t||(t="#"),t=this.get_node(t);if(!t)return!1;var r=t.id==="#"?this.get_container_ul():this.get_node(t,!0),i=this,s,o;if(!r.length){for(s=0,o=t.children_d.length;s<o;s++)this._model.data[t.children_d[s]].state.opened=!1;return this.trigger("close_all",{node:t})}r=this.is_open(t)?r.find(".jstree-open").addBack():r.find(".jstree-open"),e(r.get().reverse()).each(function(){i.close_node(this,n||0)}),this.trigger("close_all",{node:t})},is_disabled:function(e){return e=this.get_node(e),e&&e.state&&e.state.disabled},enable_node:function(t){var n,r;if(e.isArray(t)){t=t.slice();for(n=0,r=t.length;n<r;n++)this.enable_node(t[n]);return!0}t=this.get_node(t);if(!t||t.id==="#")return!1;t.state.disabled=!1,this.get_node(t,!0).children(".jstree-anchor").removeClass("jstree-disabled"),this.trigger("enable_node",{node:t})},disable_node:function(t){var n,r;if(e.isArray(t)){t=t.slice();for(n=0,r=t.length;n<r;n++)this.disable_node(t[n]);return!0}t=this.get_node(t);if(!t||t.id==="#")return!1;t.state.disabled=!0,this.get_node(t,!0).children(".jstree-anchor").addClass("jstree-disabled"),this.trigger("disable_node",{node:t})},activate_node:function(e,n){if(this.is_disabled(e))return!1;this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==t?this.get_node(this._data.core.last_clicked.id):null,this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null),!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1]));if(!this.settings.core.multiple||!n.metaKey&&!n.ctrlKey&&!n.shiftKey||n.shiftKey&&(!this._data.core.last_clicked||!this.get_parent(e)||this.get_parent(e)!==this._data.core.last_clicked.parent))!this.settings.core.multiple&&(n.metaKey||n.ctrlKey||n.shiftKey)&&this.is_selected(e)?this.deselect_node(e,!1,n):(this.deselect_all(!0),this.select_node(e,!1,!1,n),this._data.core.last_clicked=this.get_node(e));else if(n.shiftKey){var r=this.get_node(e).id,i=this._data.core.last_clicked.id,s=this.get_node(this._data.core.last_clicked.parent).children,o=!1,u,a;for(u=0,a=s.length;u<a;u+=1)s[u]===r&&(o=!o),s[u]===i&&(o=!o),o||s[u]===r||s[u]===i?this.select_node(s[u],!1,!1,n):this.deselect_node(s[u],!1,n)}else this.is_selected(e)?this.deselect_node(e,!1,n):this.select_node(e,!1,!1,n);this.trigger("activate_node",{node:this.get_node(e)})},hover_node:function(e){e=this.get_node(e,!0);if(!e||!e.length||e.children(".jstree-hovered").length)return!1;var t=this.element.find(".jstree-hovered"),n=this.element;t&&t.length&&this.dehover_node(t),e.children(".jstree-anchor").addClass("jstree-hovered"),this.trigger("hover_node",{node:this.get_node(e)}),setTimeout(function(){n.attr("aria-activedescendant",e[0].id),e.attr("aria-selected",!0)},0)},dehover_node:function(e){e=this.get_node(e,!0);if(!e||!e.length||!e.children(".jstree-hovered").length)return!1;e.attr("aria-selected",!1).children(".jstree-anchor").removeClass("jstree-hovered"),this.trigger("dehover_node",{node:this.get_node(e)})},select_node:function(t,n,r,i){var s,o,u,a;if(e.isArray(t)){t=t.slice();for(o=0,u=t.length;o<u;o++)this.select_node(t[o],n,r,i);return!0}t=this.get_node(t);if(!t||t.id==="#")return!1;s=this.get_node(t,!0),t.state.selected||(t.state.selected=!0,this._data.core.selected.push(t.id),r||(s=this._open_to(t)),s&&s.length&&s.children(".jstree-anchor").addClass("jstree-clicked"),this.trigger("select_node",{node:t,selected:this._data.core.selected,event:i}),n||this.trigger("changed",{action:"select_node",node:t,selected:this._data.core.selected,event:i}))},deselect_node:function(t,n,r){var i,s,o;if(e.isArray(t)){t=t.slice();for(i=0,s=t.length;i<s;i++)this.deselect_node(t[i],n,r);return!0}t=this.get_node(t);if(!t||t.id==="#")return!1;o=this.get_node(t,!0),t.state.selected&&(t.state.selected=!1,this._data.core.selected=e.vakata.array_remove_item(this._data.core.selected,t.id),o.length&&o.children(".jstree-anchor").removeClass("jstree-clicked"),this.trigger("deselect_node",{node:t,selected:this._data.core.selected,event:r}),n||this.trigger("changed",{action:"deselect_node",node:t,selected:this._data.core.selected,event:r}))},select_all:function(e){var t=this._data.core.selected.concat([]),n,r;this._data.core.selected=this._model.data["#"].children_d.concat();for(n=0,r=this._data.core.selected.length;n<r;n++)this._model.data[this._data.core.selected[n]]&&(this._model.data[this._data.core.selected[n]].state.selected=!0);this.redraw(!0),this.trigger("select_all",{selected:this._data.core.selected}),e||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:t})},deselect_all:function(e){var t=this._data.core.selected.concat([]),n,r;for(n=0,r=this._data.core.selected.length;n<r;n++)this._model.data[this._data.core.selected[n]]&&(this._model.data[this._data.core.selected[n]].state.selected=!1);this._data.core.selected=[],this.element.find(".jstree-clicked").removeClass("jstree-clicked"),this.trigger("deselect_all",{selected:this._data.core.selected,node:t}),e||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:t})},is_selected:function(e){return e=this.get_node(e),!e||e.id==="#"?!1:e.state.selected},get_selected:function(t){return t?e.map(this._data.core.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.core.selected},get_top_selected:function(t){var n=this.get_selected(!0),r={},i,s,o,u;for(i=0,s=n.length;i<s;i++)r[n[i].id]=n[i];for(i=0,s=n.length;i<s;i++)for(o=0,u=n[i].children_d.length;o<u;o++)r[n[i].children_d[o]]&&delete r[n[i].children_d[o]];n=[];for(i in r)r.hasOwnProperty(i)&&n.push(i);return t?e.map(n,e.proxy(function(e){return this.get_node(e)},this)):n},get_bottom_selected:function(t){var n=this.get_selected(!0),r=[],i,s;for(i=0,s=n.length;i<s;i++)n[i].children.length||r.push(n[i].id);return t?e.map(r,e.proxy(function(e){return this.get_node(e)},this)):r},get_state:function(){var e={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}},t;for(t in this._model.data)this._model.data.hasOwnProperty(t)&&t!=="#"&&(this._model.data[t].state.opened&&e.core.open.push(t),this._model.data[t].state.selected&&e.core.selected.push(t));return e},set_state:function(n,r){if(n){if(n.core){var i,s,o,u;if(n.core.open)return e.isArray(n.core.open)?(i=!0,s=!1,o=this,e.each(n.core.open.concat([]),function(t,u){s=o.get_node(u),s&&(o.is_loaded(u)?(o.is_closed(u)&&o.open_node(u,!1,0),n&&n.core&&n.core.open&&e.vakata.array_remove_item(n.core.open,u)):(o.is_loading(u)||o.open_node(u,e.proxy(function(t,i){!i&&n&&n.core&&n.core.open&&e.vakata.array_remove_item(n.core.open,t.id),this.set_state(n,r)},o),0),i=!1))}),i&&(delete n.core.open,this.set_state(n,r)),!1):(delete n.core.open,this.set_state(n,r),!1);if(n.core.scroll)return n.core.scroll&&n.core.scroll.left!==t&&this.element.scrollLeft(n.core.scroll.left),n.core.scroll&&n.core.scroll.top!==t&&this.element.scrollTop(n.core.scroll.top),delete n.core.scroll,this.set_state(n,r),!1;if(n.core.selected)return u=this,this.deselect_all(),e.each(n.core.selected,function(e,t){u.select_node(t)}),delete n.core.selected,this.set_state(n,r),!1;if(e.isEmptyObject(n.core))return delete n.core,this.set_state(n,r),!1}return e.isEmptyObject(n)?(n=null,r&&r.call(this),this.trigger("set_state"),!1):!0}return!1},refresh:function(t){this._data.core.state=this.get_state(),this._cnt=0,this._model.data={"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}}};var n=this.get_container_ul()[0].className;t||this.element.html("<ul class='"+n+"'><"+"li class='jstree-initial-node jstree-loading jstree-leaf jstree-last'><i class='jstree-icon jstree-ocl'></i><"+"a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.load_node("#",function(t,r){r&&(this.get_container_ul()[0].className=n,this.set_state(e.extend(!0,{},this._data.core.state),function(){this.trigger("refresh")})),this._data.core.state=null})},refresh_node:function(t){t=this.get_node(t);if(!t||t.id==="#")return!1;var n=[],r=this._data.core.selected.concat([]);t.state.opened===!0&&n.push(t.id),this.get_node(t,!0).find(".jstree-open").each(function(){n.push(this.id)}),this._load_nodes(n,e.proxy(function(e){this.open_node(e,!1,0),this.select_node(this._data.core.selected),this.trigger("refresh_node",{node:t,nodes:e})},this))},set_id:function(t,n){t=this.get_node(t);if(!t||t.id==="#")return!1;var r,i,s=this._model.data;n=n.toString(),s[t.parent].children[e.inArray(t.id,s[t.parent].children)]=n;for(r=0,i=t.parents.length;r<i;r++)s[t.parents[r]].children_d[e.inArray(t.id,s[t.parents[r]].children_d)]=n;for(r=0,i=t.children.length;r<i;r++)s[t.children[r]].parent=n;for(r=0,i=t.children_d.length;r<i;r++)s[t.children_d[r]].parents[e.inArray(t.id,s[t.children_d[r]].parents)]=n;return r=e.inArray(t.id,this._data.core.selected),r!==-1&&(this._data.core.selected[r]=n),r=this.get_node(t.id,!0),r&&r.attr("id",n),delete s[t.id],t.id=n,s[n]=t,!0},get_text:function(e){return e=this.get_node(e),!e||e.id==="#"?!1:e.text},set_text:function(t,n){var r,i,s,o;if(e.isArray(t)){t=t.slice();for(r=0,i=t.length;r<i;r++)this.set_text(t[r],n);return!0}return t=this.get_node(t),!t||t.id==="#"?!1:(t.text=n,s=this.get_node(t,!0),s.length&&(s=s.children(".jstree-anchor:eq(0)"),o=s.children("I").clone(),s.html(n).prepend(o),this.trigger("set_text",{obj:t,text:n})),!0)},get_json:function(e,t,n){e=this.get_node(e||"#");if(!e)return!1;t&&t.flat&&!n&&(n=[]);var r={id:e.id,text:e.text,icon:this.get_icon(e),li_attr:e.li_attr,a_attr:e.a_attr,state:{},data:t&&t.no_data?!1:e.data},i,s;t&&t.flat?r.parent=e.parent:r.children=[];if(!t||!t.no_state)for(i in e.state)e.state.hasOwnProperty(i)&&(r.state[i]=e.state[i]);t&&t.no_id&&(delete r.id,r.li_attr&&r.li_attr.id&&delete r.li_attr.id),t&&t.flat&&e.id!=="#"&&n.push(r);if(!t||!t.no_children)for(i=0,s=e.children.length;i<s;i++)t&&t.flat?this.get_json(e.children[i],t,n):r.children.push(this.get_json(e.children[i],t));return t&&t.flat?n:e.id==="#"?r.children:r},create_node:function(n,r,i,s,o){n===null&&(n="#"),n=this.get_node(n);if(!n)return!1;i=i===t?"last":i;if(!i.toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(n))return this.load_node(n,function(){this.create_node(n,r,i,s,!0)});r||(r={text:this.get_string("New node")}),r.text===t&&(r.text=this.get_string("New node"));var u,a,f,l;n.id==="#"&&(i==="before"&&(i="first"),i==="after"&&(i="last"));switch(i){case"before":u=this.get_node(n.parent),i=e.inArray(n.id,u.children),n=u;break;case"after":u=this.get_node(n.parent),i=e.inArray(n.id,u.children)+1,n=u;break;case"inside":case"first":i=0;break;case"last":i=n.children.length;break;default:i||(i=0)}i>n.children.length&&(i=n.children.length),r.id||(r.id=!0);if(!this.check("create_node",r,n,i))return this.settings.core.error.call(this,this._data.core.last_error),!1;r.id===!0&&delete r.id,r=this._parse_model_from_json(r,n.id,n.parents.concat());if(!r)return!1;u=this.get_node(r),a=[],a.push(r),a=a.concat(u.children_d),this.trigger("model",{nodes:a,parent:n.id}),n.children_d=n.children_d.concat(a);for(f=0,l=n.parents.length;f<l;f++)this._model.data[n.parents[f]].children_d=this._model.data[n.parents[f]].children_d.concat(a);r=u,u=[];for(f=0,l=n.children.length;f<l;f++)u[f>=i?f+1:f]=n.children[f];return u[i]=r.id,n.children=u,this.redraw_node(n,!0),s&&s.call(this,this.get_node(r)),this.trigger("create_node",{node:this.get_node(r),parent:n.id,position:i}),r.id},rename_node:function(t,n){var r,i,s;if(e.isArray(t)){t=t.slice();for(r=0,i=t.length;r<i;r++)this.rename_node(t[r],n);return!0}return t=this.get_node(t),!t||t.id==="#"?!1:(s=t.text,this.check("rename_node",t,this.get_parent(t),n)?(this.set_text(t,n),this.trigger("rename_node",{node:t,text:n,old:s}),!0):(this.settings.core.error.call(this,this._data.core.last_error),!1))},delete_node:function(t){var n,r,i,s,o,u,a,f,l,c;if(e.isArray(t)){t=t.slice();for(n=0,r=t.length;n<r;n++)this.delete_node(t[n]);return!0}t=this.get_node(t);if(!t||t.id==="#")return!1;i=this.get_node(t.parent),s=e.inArray(t.id,i.children),c=!1;if(!this.check("delete_node",t,i,s))return this.settings.core.error.call(this,this._data.core.last_error),!1;s!==-1&&(i.children=e.vakata.array_remove(i.children,s)),o=t.children_d.concat([]),o.push(t.id);for(f=0,l=o.length;f<l;f++){for(u=0,a=t.parents.length;u<a;u++)s=e.inArray(o[f],this._model.data[t.parents[u]].children_d),s!==-1&&(this._model.data[t.parents[u]].children_d=e.vakata.array_remove(this._model.data[t.parents[u]].children_d,s));this._model.data[o[f]].state.selected&&(c=!0,s=e.inArray(o[f],this._data.core.selected),s!==-1&&(this._data.core.selected=e.vakata.array_remove(this._data.core.selected,s)))}this.trigger("delete_node",{node:t,parent:i.id}),c&&this.trigger("changed",{action:"delete_node",node:t,selected:this._data.core.selected,parent:i.id});for(f=0,l=o.length;f<l;f++)delete this._model.data[o[f]];return this.redraw_node(i,!0),!0},check:function(t,n,r,i,s){n=n&&n.id?n:this.get_node(n),r=r&&r.id?r:this.get_node(r);var o=t.match(/^move_node|copy_node|create_node$/i)?r:n,u=this.settings.core.check_callback;if(t==="move_node"||t==="copy_node")if((!s||!s.is_multi)&&(n.id===r.id||e.inArray(n.id,r.children)===i||e.inArray(r.id,n.children_d)!==-1))return this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:t,pos:i,obj:n&&n.id?n.id:!1,par:r&&r.id?r.id:!1})},!1;return o&&o.data&&(o=o.data),o&&o.functions&&(o.functions[t]===!1||o.functions[t]===!0)?(o.functions[t]===!1&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+t,data:JSON.stringify({chk:t,pos:i,obj:n&&n.id?n.id:!1,par:r&&r.id?r.id:!1})}),o.functions[t]):u===!1||e.isFunction(u)&&u.call(this,t,n,r,i,s)===!1||u&&u[t]===!1?(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+t,data:JSON.stringify({chk:t,pos:i,obj:n&&n.id?n.id:!1,par:r&&r.id?r.id:!1})},!1):!0},last_error:function(){return this._data.core.last_error},move_node:function(n,r,i,s,o){var u,a,f,l,c,h,p,d,v,m,g,y,b,w;r=this.get_node(r),i=i===t?0:i;if(!r)return!1;if(!i.toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(r))return this.load_node(r,function(){this.move_node(n,r,i,s,!0)});if(e.isArray(n)){n=n.reverse().slice();for(u=0,a=n.length;u<a;u++)this.move_node(n[u],r,i,s,o);return!0}n=n&&n.id?n:this.get_node(n);if(!n||n.id==="#")return!1;f=(n.parent||"#").toString(),c=!i.toString().match(/^(before|after)$/)||r.id==="#"?r:this.get_node(r.parent),h=n.instance?n.instance:this._model.data[n.id]?this:e.jstree.reference(n.id),p=!h||!h._id||this._id!==h._id,l=h&&h._id&&f&&h._model.data[f]&&h._model.data[f].children?e.inArray(n.id,h._model.data[f].children):-1;if(p)return this.copy_node(n,r,i,s,o)?(h&&h.delete_node(n),!0):!1;c.id==="#"&&(i==="before"&&(i="first"),i==="after"&&(i="last"));switch(i){case"before":i=e.inArray(r.id,c.children);break;case"after":i=e.inArray(r.id,c.children)+1;break;case"inside":case"first":i=0;break;case"last":i=c.children.length;break;default:i||(i=0)}i>c.children.length&&(i=c.children.length);if(!this.check("move_node",n,c,i,{core:!0,is_multi:h&&h._id&&h._id!==this._id,is_foreign:!h||!h._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(n.parent===c.id){d=c.children.concat(),v=e.inArray(n.id,d),v!==-1&&(d=e.vakata.array_remove(d,v),i>v&&i--),v=[];for(m=0,g=d.length;m<g;m++)v[m>=i?m+1:m]=d[m];v[i]=n.id,c.children=v,this._node_changed(c.id),this.redraw(c.id==="#")}else{v=n.children_d.concat(),v.push(n.id);for(m=0,g=n.parents.length;m<g;m++){d=[],w=h._model.data[n.parents[m]].children_d;for(y=0,b=w.length;y<b;y++)e.inArray(w[y],v)===-1&&d.push(w[y]);h._model.data[n.parents[m]].children_d=d}h._model.data[f].children=e.vakata.array_remove_item(h._model.data[f].children,n.id);for(m=0,g=c.parents.length;m<g;m++)this._model.data[c.parents[m]].children_d=this._model.data[c.parents[m]].children_d.concat(v);d=[];for(m=0,g=c.children.length;m<g;m++)d[m>=i?m+1:m]=c.children[m];d[i]=n.id,c.children=d,c.children_d.push(n.id),c.children_d=c.children_d.concat(n.children_d),n.parent=c.id,v=c.parents.concat(),v.unshift(c.id),w=n.parents.length,n.parents=v,v=v.concat();for(m=0,g=n.children_d.length;m<g;m++)this._model.data[n.children_d[m]].parents=this._model.data[n.children_d[m]].parents.slice(0,w*-1),Array.prototype.push.apply(this._model.data[n.children_d[m]].parents,v);this._node_changed(f),this._node_changed(c.id),this.redraw(f==="#"||c.id==="#")}return s&&s.call(this,n,c,i),this.trigger("move_node",{node:n,parent:c.id,position:i,old_parent:f,old_position:l,is_multi:h&&h._id&&h._id!==this._id,is_foreign:!h||!h._id,old_instance:h,new_instance:this}),!0},copy_node:function(n,r,i,s,o){var u,a,f,l,c,h,p,d,v,m,g;r=this.get_node(r),i=i===t?0:i;if(!r)return!1;if(!i.toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(r))return this.load_node(r,function(){this.copy_node(n,r,i,s,!0)});if(e.isArray(n)){n=n.reverse().slice();for(u=0,a=n.length;u<a;u++)this.copy_node(n[u],r,i,s,o);return!0}n=n&&n.id?n:this.get_node(n);if(!n||n.id==="#")return!1;d=(n.parent||"#").toString(),v=!i.toString().match(/^(before|after)$/)||r.id==="#"?r:this.get_node(r.parent),m=n.instance?n.instance:this._model.data[n.id]?this:e.jstree.reference(n.id),g=!m||!m._id||this._id!==m._id,v.id==="#"&&(i==="before"&&(i="first"),i==="after"&&(i="last"));switch(i){case"before":i=e.inArray(r.id,v.children);break;case"after":i=e.inArray(r.id,v.children)+1;break;case"inside":case"first":i=0;break;case"last":i=v.children.length;break;default:i||(i=0)}i>v.children.length&&(i=v.children.length);if(!this.check("copy_node",n,v,i,{core:!0,is_multi:m&&m._id&&m._id!==this._id,is_foreign:!m||!m._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;p=m?m.get_json(n,{no_id:!0,no_data:!0,no_state:!0}):n;if(!p)return!1;p.id===!0&&delete p.id,p=this._parse_model_from_json(p,v.id,v.parents.concat());if(!p)return!1;l=this.get_node(p),n&&n.state&&n.state.loaded===!1&&(l.state.loaded=!1),f=[],f.push(p),f=f.concat(l.children_d),this.trigger("model",{nodes:f,parent:v.id});for(c=0,h=v.parents.length;c<h;c++)this._model.data[v.parents[c]].children_d=this._model.data[v.parents[c]].children_d.concat(f);f=[];for(c=0,h=v.children.length;c<h;c++)f[c>=i?c+1:c]=v.children[c];return f[i]=l.id,v.children=f,v.children_d.push(l.id),v.children_d=v.children_d.concat(l.children_d),this._node_changed(v.id),this.redraw(v.id==="#"),s&&s.call(this,l,v,i),this.trigger("copy_node",{node:l,original:n,parent:v.id,position:i,old_parent:d,old_position:m&&m._id&&d&&m._model.data[d]&&m._model.data[d].children?e.inArray(n.id,m._model.data[d].children):-1,is_multi:m&&m._id&&m._id!==this._id,is_foreign:!m||!m._id,old_instance:m,new_instance:this}),l.id},cut:function(t){t||(t=this._data.core.selected.concat()),e.isArray(t)||(t=[t]);if(!t.length)return!1;var n=[],o,u,a;for(u=0,a=t.length;u<a;u++)o=this.get_node(t[u]),o&&o.id&&o.id!=="#"&&n.push(o);if(!n.length)return!1;r=n,s=this,i="move_node",this.trigger("cut",{node:t})},copy:function(t){t||(t=this._data.core.selected.concat()),e.isArray(t)||(t=[t]);if(!t.length)return!1;var n=[],o,u,a;for(u=0,a=t.length;u<a;u++)o=this.get_node(t[u]),o&&o.id&&o.id!=="#"&&n.push(o);if(!n.length)return!1;r=n,s=this,i="copy_node",this.trigger("copy",{node:t})},get_buffer:function(){return{mode:i,node:r,inst:s}},can_paste:function(){return i!==!1&&r!==!1},paste:function(e,t){e=this.get_node(e);if(!e||!i||!i.match(/^(copy_node|move_node)$/)||!r)return!1;this[i](r,e,t)&&this.trigger("paste",{parent:e.id,node:r,mode:i}),r=!1,i=!1,s=!1},edit:function(t,n){t=this._open_to(t);if(!t||!t.length)return!1;if(this.settings.core.check_callback===!1)return this._data.core.last_error={error:"check",plugin:"core",id:"core_07",reason:"Could not edit node because of check_callback"},this.settings.core.error.call(this,this._data.core.last_error),!1;var r=this._data.core.rtl,i=this.element.width(),s=t.children(".jstree-anchor"),o=e("<span>"),u=typeof n=="string"?n:this.get_text(t),a=e("<div />",{css:{position:"absolute",top:"-200px",left:r?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),f=e("<input />",{value:u,"class":"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:e.proxy(function(){var e=o.children(".jstree-rename-input"),n=e.val();n===""&&(n=u),a.remove(),o.replaceWith(s),o.remove(),this.set_text(t,u),this.rename_node(t,n)===!1&&this.set_text(t,u)},this),keydown:function(e){var t=e.which;t===27&&(this.value=u),(t===27||t===13||t===37||t===38||t===39||t===40||t===32)&&e.stopImmediatePropagation();if(t===27||t===13)e.preventDefault(),this.blur()},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){f.width(Math.min(a.text("pW"+this.value).width(),i))},keypress:function(e){if(e.which===13)return!1}}),l={fontFamily:s.css("fontFamily")||"",fontSize:s.css("fontSize")||"",fontWeight:s.css("fontWeight")||"",fontStyle:s.css("fontStyle")||"",fontStretch:s.css("fontStretch")||"",fontVariant:s.css("fontVariant")||"",letterSpacing:s.css("letterSpacing")||"",wordSpacing:s.css("wordSpacing")||""};this.set_text(t,""),o.attr("class",s.attr("class")).append(s.contents().clone()).append(f),s.replaceWith(o),a.css(l),f.css(l).width(Math.min(a.text("pW"+f[0].value).width(),i))[0].select()},set_theme:function(t,n){if(!t)return!1;if(n===!0){var r=this.settings.core.themes.dir;r||(r=e.jstree.path+"/themes"),n=r+"/"+t+"/style.css"}n&&e.inArray(n,o)===-1&&(e("head").append('<link rel="stylesheet" href="'+n+'" type="text/css" />'),o.push(n)),this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name),this._data.core.themes.name=t,this.element.addClass("jstree-"+t),this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+t+"-responsive"),this.trigger("set_theme",{theme:t})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(e){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant),this._data.core.themes.variant=e,e&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0,this.get_container_ul().addClass("jstree-striped")},hide_stripes:function(){this._data.core.themes.stripes=!1,this.get_container_ul().removeClass("jstree-striped")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0,this.get_container_ul().removeClass("jstree-no-dots")},hide_dots:function(){this._data.core.themes.dots=!1,this.get_container_ul().addClass("jstree-no-dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0,this.get_container_ul().removeClass("jstree-no-icons")},hide_icons:function(){this._data.core.themes.icons=!1,this.get_container_ul().addClass("jstree-no-icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},set_icon:function(t,n){var r,i,s,o;if(e.isArray(t)){t=t.slice();for(r=0,i=t.length;r<i;r++)this.set_icon(t[r],n);return!0}return t=this.get_node(t),!t||t.id==="#"?!1:(o=t.icon,t.icon=n,s=this.get_node(t,!0).children(".jstree-anchor").children(".jstree-themeicon"),n===!1?this.hide_icon(t):n===!0?s.removeClass("jstree-themeicon-custom "+o).css("background","").removeAttr("rel"):n.indexOf("/")===-1&&n.indexOf(".")===-1?(s.removeClass(o).css("background",""),s.addClass(n+" jstree-themeicon-custom").attr("rel",n)):(s.removeClass(o).css("background",""),s.addClass("jstree-themeicon-custom").css("background","url('"+n+"') center center no-repeat").attr("rel",n)),!0)},get_icon:function(e){return e=this.get_node(e),!e||e.id==="#"?!1:e.icon},hide_icon:function(t){var n,r;if(e.isArray(t)){t=t.slice();for(n=0,r=t.length;n<r;n++)this.hide_icon(t[n]);return!0}return t=this.get_node(t),!t||t==="#"?!1:(t.icon=!1,this.get_node(t,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden"),!0)},show_icon:function(t){var n,r,i;if(e.isArray(t)){t=t.slice();for(n=0,r=t.length;n<r;n++)this.show_icon(t[n]);return!0}return t=this.get_node(t),!t||t==="#"?!1:(i=this.get_node(t,!0),t.icon=i.length?i.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"):!0,t.icon||(t.icon=!0),i.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden"),!0)}},e.vakata={},e.vakata.attributes=function(t,n){t=e(t)[0];var r=n?{}:[];return t&&t.attributes&&e.each(t.attributes,function(t,i){if(e.inArray(i.nodeName.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])!==-1)return;i.nodeValue!==null&&e.trim(i.nodeValue)!==""&&(n?r[i.nodeName]=i.nodeValue:r.push(i.nodeName))}),r},e.vakata.array_unique=function(e){var t=[],n,r,i;for(n=0,i=e.length;n<i;n++){for(r=0;r<=n;r++)if(e[n]===e[r])break;r===n&&t.push(e[n])}return t},e.vakata.array_remove=function(e,t,n){var r=e.slice((n||t)+1||e.length);return e.length=t<0?e.length+t:t,e.push.apply(e,r),e},e.vakata.array_remove_item=function(t,n){var r=e.inArray(n,t);return r!==-1?e.vakata.array_remove(t,r):t};var h=document.createElement("I");h.className="jstree-icon jstree-checkbox",e.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:""},e.jstree.plugins.checkbox=function(t,n){this.bind=function(){n.bind.call(this),this._data.checkbox.uto=!1,this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined"),this.element.on("init.jstree",e.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible,this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked")},this)).on("loading.jstree",e.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()},this)),this.settings.checkbox.cascade.indexOf("undetermined")!==-1&&this.element.on("changed.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",e.proxy(function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)},this)),(this.settings.checkbox.cascade.indexOf("up")!==-1||this.settings.checkbox.cascade.indexOf("down")!==-1)&&this.element.on("model.jstree",e.proxy(function(t,n){var r=this._model.data,i=r[n.parent],s=n.nodes,o=[],u,a,f,l,c,h,p=this.settings.checkbox.cascade;if(p.indexOf("down")!==-1)if(i.state.selected){for(a=0,f=s.length;a<f;a++)r[s[a]].state.selected=!0;this._data.core.selected=this._data.core.selected.concat(s)}else for(a=0,f=s.length;a<f;a++)if(r[s[a]].state.selected){for(l=0,c=r[s[a]].children_d.length;l<c;l++)r[r[s[a]].children_d[l]].state.selected=!0;this._data.core.selected=this._data.core.selected.concat(r[s[a]].children_d)}if(p.indexOf("up")!==-1){for(a=0,f=i.children_d.length;a<f;a++)r[i.children_d[a]].children.length||o.push(r[i.children_d[a]].parent);o=e.vakata.array_unique(o);for(l=0,c=o.length;l<c;l++){i=r[o[l]];while(i&&i.id!=="#"){u=0;for(a=0,f=i.children.length;a<f;a++)u+=r[i.children[a]].state.selected;if(u!==f)break;i.state.selected=!0,this._data.core.selected.push(i.id),h=this.get_node(i,!0),h&&h.length&&h.children(".jstree-anchor").addClass("jstree-clicked"),i=this.get_node(i.parent)}}}this._data.core.selected=e.vakata.array_unique(this._data.core.selected)},this)).on("select_node.jstree",e.proxy(function(t,n){var r=n.node,i=this._model.data,s=this.get_node(r.parent),o=this.get_node(r,!0),u,a,f,l,c=this.settings.checkbox.cascade;if(c.indexOf("down")!==-1){this._data.core.selected=e.vakata.array_unique(this._data.core.selected.concat(r.children_d));for(u=0,a=r.children_d.length;u<a;u++)l=i[r.children_d[u]],l.state.selected=!0,l&&l.original&&l.original.state&&l.original.state.undetermined&&(l.original.state.undetermined=!1)}if(c.indexOf("up")!==-1)while(s&&s.id!=="#"){f=0;for(u=0,a=s.children.length;u<a;u++)f+=i[s.children[u]].state.selected;if(f!==a)break;s.state.selected=!0,this._data.core.selected.push(s.id),l=this.get_node(s,!0),l&&l.length&&l.children(".jstree-anchor").addClass("jstree-clicked"),s=this.get_node(s.parent)}c.indexOf("down")!==-1&&o.length&&o.find(".jstree-anchor").addClass("jstree-clicked")},this)).on("deselect_all.jstree",e.proxy(function(e,t){var n=this.get_node("#"),r=this._model.data,i,s,o;for(i=0,s=n.children_d.length;i<s;i++)o=r[n.children_d[i]],o&&o.original&&o.original.state&&o.original.state.undetermined&&(o.original.state.undetermined=!1)},this)).on("deselect_node.jstree",e.proxy(function(t,n){var r=n.node,i=this.get_node(r,!0),s,o,u,a=this.settings.checkbox.cascade;r&&r.original&&r.original.state&&r.original.state.undetermined&&(r.original.state.undetermined=!1);if(a.indexOf("down")!==-1)for(s=0,o=r.children_d.length;s<o;s++)u=this._model.data[r.children_d[s]],u.state.selected=!1,u&&u.original&&u.original.state&&u.original.state.undetermined&&(u.original.state.undetermined=!1);if(a.indexOf("up")!==-1)for(s=0,o=r.parents.length;s<o;s++)u=this._model.data[r.parents[s]],u.state.selected=!1,u&&u.original&&u.original.state&&u.original.state.undetermined&&(u.original.state.undetermined=!1),u=this.get_node(r.parents[s],!0),u&&u.length&&u.children(".jstree-anchor").removeClass("jstree-clicked");u=[];for(s=0,o=this._data.core.selected.length;s<o;s++)(a.indexOf("down")===-1||e.inArray(this._data.core.selected[s],r.children_d)===-1)&&(a.indexOf("up")===-1||e.inArray(this._data.core.selected[s],r.parents)===-1)&&u.push(this._data.core.selected[s]);this._data.core.selected=e.vakata.array_unique(u),a.indexOf("down")!==-1&&i.length&&i.find(".jstree-anchor").removeClass("jstree-clicked")},this)),this.settings.checkbox.cascade.indexOf("up")!==-1&&this.element.on("delete_node.jstree",e.proxy(function(e,t){var n=this.get_node(t.parent),r=this._model.data,i,s,o,u;while(n&&n.id!=="#"){o=0;for(i=0,s=n.children.length;i<s;i++)o+=r[n.children[i]].state.selected;if(o!==s)break;n.state.selected=!0,this._data.core.selected.push(n.id),u=this.get_node(n,!0),u&&u.length&&u.children(".jstree-anchor").addClass("jstree-clicked"),n=this.get_node(n.parent)}},this)).on("move_node.jstree",e.proxy(function(t,n){var r=n.is_multi,i=n.old_parent,s=this.get_node(n.parent),o=this._model.data,u,a,f,l,c;if(!r){u=this.get_node(i);while(u&&u.id!=="#"){a=0;for(f=0,l=u.children.length;f<l;f++)a+=o[u.children[f]].state.selected;if(a!==l)break;u.state.selected=!0,this._data.core.selected.push(u.id),c=this.get_node(u,!0),c&&c.length&&c.children(".jstree-anchor").addClass("jstree-clicked"),u=this.get_node(u.parent)}}u=s;while(u&&u.id!=="#"){a=0;for(f=0,l=u.children.length;f<l;f++)a+=o[u.children[f]].state.selected;if(a===l)u.state.selected||(u.state.selected=!0,this._data.core.selected.push(u.id),c=this.get_node(u,!0),c&&c.length&&c.children(".jstree-anchor").addClass("jstree-clicked"));else{if(!u.state.selected)break;u.state.selected=!1,this._data.core.selected=e.vakata.array_remove_item(this._data.core.selected,u.id),c=this.get_node(u,!0),c&&c.length&&c.children(".jstree-anchor").removeClass("jstree-clicked")}u=this.get_node(u.parent)}},this))},this._undetermined=function(){var t,n,r=this._model.data,i=this._data.core.selected,s=[],o=this;for(t=0,n=i.length;t<n;t++)r[i[t]]&&r[i[t]].parents&&(s=s.concat(r[i[t]].parents));this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var e=o.get_node(this),i;if(!e.state.loaded)e.original&&e.original.state&&e.original.state.undetermined&&e.original.state.undetermined===!0&&(s.push(e.id),s=s.concat(e.parents));else for(t=0,n=e.children_d.length;t<n;t++)i=r[e.children_d[t]],!i.state.loaded&&i.original&&i.original.state&&i.original.state.undetermined&&i.original.state.undetermined===!0&&(s.push(i.id),s=s.concat(i.parents))}),s=e.vakata.array_unique(s),s=e.vakata.array_remove_item(s,"#"),this.element.find(".jstree-undetermined").removeClass("jstree-undetermined");for(t=0,n=s.length;t<n;t++)r[s[t]].state.selected||(i=this.get_node(s[t],!0),i&&i.length&&i.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined"))},this.redraw_node=function(t,r,i){t=n.redraw_node.call(this,t,r,i);if(t){var s,o,u=null;for(s=0,o=t.childNodes.length;s<o;s++)if(t.childNodes[s]&&t.childNodes[s].className&&t.childNodes[s].className.indexOf("jstree-anchor")!==-1){u=t.childNodes[s];break}u&&u.insertBefore(h.cloneNode(!1),u.childNodes[0])}return!i&&this.settings.checkbox.cascade.indexOf("undetermined")!==-1&&(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)),t},this.activate_node=function(t,r){if(this.settings.checkbox.whole_node||e(r.target).hasClass("jstree-checkbox"))r.ctrlKey=!0;return n.activate_node.call(this,t,r)},this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0,this.get_container_ul().removeClass("jstree-no-checkboxes")},this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1,this.get_container_ul().addClass("jstree-no-checkboxes")},this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()}},e.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(t,n){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(t){var n=e.jstree.reference(t.reference),r=n.get_node(t.reference);n.create_node(r,{},"last",function(e){setTimeout(function(){n.edit(e)},0)})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(t){var n=e.jstree.reference(t.reference),r=n.get_node(t.reference);n.edit(r)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(t){var n=e.jstree.reference(t.reference),r=n.get_node(t.reference);n.is_selected(r)?n.delete_node(n.get_selected()):n.delete_node(r)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(t){var n=e.jstree.reference(t.reference),r=n.get_node(t.reference);n.is_selected(r)?n.cut(n.get_selected()):n.cut(r)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(t){var n=e.jstree.reference(t.reference),r=n.get_node(t.reference);n.is_selected(r)?n.copy(n.get_selected()):n.copy(r)}},paste:{separator_before:!1,icon:!1,_disabled:function(t){return!e.jstree.reference(t.reference).can_paste()},separator_after:!1,label:"Paste",action:function(t){var n=e.jstree.reference(t.reference),r=n.get_node(t.reference);n.paste(r)}}}}}}},e.jstree.plugins.contextmenu=function(n,r){this.bind=function(){r.bind.call(this);var t=0;this.element.on("contextmenu.jstree",".jstree-anchor",e.proxy(function(e){e.preventDefault(),t=e.ctrlKey?e.timeStamp:0,this.is_loading(e.currentTarget)||this.show_contextmenu(e.currentTarget,e.pageX,e.pageY,e)},this)).on("click.jstree",".jstree-anchor",e.proxy(function(n){this._data.contextmenu.visible&&(!t||n.timeStamp-t>250)&&e.vakata.context.hide()},this)),e(document).on("context_hide.vakata",e.proxy(function(){this._data.contextmenu.visible=!1},this))},this.teardown=function(){this._data.contextmenu.visible&&e.vakata.context.hide(),r.teardown.call(this)},this.show_contextmenu=function(n,r,i,s){n=this.get_node(n);if(!n||n.id==="#")return!1;var o=this.settings.contextmenu,u=this.get_node(n,!0),a=u.children(".jstree-anchor"),f=!1,l=!1;if(o.show_at_node||r===t||i===t)f=a.offset(),r=f.left,i=f.top+this._data.core.li_height;this.settings.contextmenu.select_node&&!this.is_selected(n)&&this.activate_node(n,s),l=o.items,e.isFunction(l)&&(l=l.call(this,n,e.proxy(function(e){this._show_contextmenu(n,r,i,e)},this))),e.isPlainObject(l)&&this._show_contextmenu(n,r,i,l)},this._show_contextmenu=function(t,n,r,i){var s=this.get_node(t,!0),o=s.children(".jstree-anchor");e(document).one("context_show.vakata",e.proxy(function(t,n){var r="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";e(n.element).addClass(r)},this)),this._data.contextmenu.visible=!0,e.vakata.context.show(o,{x:n,y:r},i),this.trigger("show_contextmenu",{node:t,x:n,y:r})}},function(e){var t=!1,n={element:!1,reference:!1,position_x:0,position_y:0,items:[],html:"",is_visible:!1};e.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(t){e(document).triggerHandler("context_"+t+".vakata",{reference:n.reference,element:n.element,position:{x:n.position_x,y:n.position_y}})},_execute:function(t){return t=n.items[t],t&&(!t._disabled||e.isFunction(t._disabled)&&!t._disabled({item:t,reference:n.reference,element:n.element}))&&t.action?t.action.call(null,{item:t,reference:n.reference,element:n.element,position:{x:n.position_x,y:n.position_y}}):!1},_parse:function(t,r){if(!t)return!1;r||(n.html="",n.items=[]);var i="",s=!1,o;return r&&(i+="<ul>"),e.each(t,function(t,r){if(!r)return!0;n.items.push(r),!s&&r.separator_before&&(i+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;<"+"/a><"+"/li>"),s=!1,i+="<li class='"+(r._class||"")+(r._disabled===!0||e.isFunction(r._disabled)&&r._disabled({item:r,reference:n.reference,element:n.element})?" vakata-contextmenu-disabled ":"")+"' "+(r.shortcut?" data-shortcut='"+r.shortcut+"' ":"")+">",i+="<a href='#' rel='"+(n.items.length-1)+"'>",e.vakata.context.settings.icons&&(i+="<i ",r.icon&&(r.icon.indexOf("/")!==-1||r.icon.indexOf(".")!==-1?i+=" style='background:url(\""+r.icon+"\") center center no-repeat' ":i+=" class='"+r.icon+"' "),i+="></i><span class='vakata-contextmenu-sep'>&#160;</span>"),i+=(e.isFunction(r.label)?r.label({item:t,reference:n.reference,element:n.element}):r.label)+(r.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+r.shortcut+'">'+(r.shortcut_label||"")+"</span>":"")+"<"+"/a>",r.submenu&&(o=e.vakata.context._parse(r.submenu,!0),o&&(i+=o)),i+="</li>",r.separator_after&&(i+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;<"+"/a><"+"/li>",s=!0)}),i=i.replace(/<li class\='vakata-context-separator'\><\/li\>$/,""),r&&(i+="</ul>"),r||(n.html=i,e.vakata.context._trigger("parse")),i.length>10?i:!1},_show_submenu:function(n){n=e(n);if(!n.length||!n.children("ul").length)return;var r=n.children("ul"),i=n.offset().left+n.outerWidth(),s=n.offset().top,o=r.width(),u=r.height(),a=e(window).width()+e(window).scrollLeft(),f=e(window).height()+e(window).scrollTop();t?n[i-(o+10+n.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left"):n[i+o+10>a?"addClass":"removeClass"]("vakata-context-right"),s+u+10>f&&r.css("bottom","-1px"),r.show()},show:function(r,i,s){var o,u,a,f,l,c,h,p,d=!0;n.element&&n.element.length&&n.element.width("");switch(d){case!i&&!r:return!1;case!!i&&!!r:n.reference=r,n.position_x=i.x,n.position_y=i.y;break;case!i&&!!r:n.reference=r,o=r.offset(),n.position_x=o.left+r.outerHeight(),n.position_y=o.top;break;case!!i&&!r:n.position_x=i.x,n.position_y=i.y}!!r&&!s&&e(r).data("vakata_contextmenu")&&(s=e(r).data("vakata_contextmenu")),e.vakata.context._parse(s)&&n.element.html(n.html),n.items.length&&(u=n.element,a=n.position_x,f=n.position_y,l=u.width(),c=u.height(),h=e(window).width()+e(window).scrollLeft(),p=e(window).height()+e(window).scrollTop(),t&&(a-=u.outerWidth(),a<e(window).scrollLeft()+20&&(a=e(window).scrollLeft()+20)),a+l+20>h&&(a=h-(l+20)),f+c+20>p&&(f=p-(c+20)),n.element.css({left:a,top:f}).show().find("a:eq(0)").focus().parent().addClass("vakata-context-hover"),n.is_visible=!0,e.vakata.context._trigger("show"))},hide:function(){n.is_visible&&(n.element.hide().find("ul").hide().end().find(":focus").blur(),n.is_visible=!1,e.vakata.context._trigger("hide"))}},e(function(){t=e("body").css("direction")==="rtl";var r=!1;n.element=e("<ul class='vakata-context'></ul>"),n.element.on("mouseenter","li",function(t){t.stopImmediatePropagation();if(e.contains(this,t.relatedTarget))return;r&&clearTimeout(r),n.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),e(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),e.vakata.context._show_submenu(this)}).on("mouseleave","li",function(t){if(e.contains(this,t.relatedTarget))return;e(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(t){e(this).find(".vakata-context-hover").removeClass("vakata-context-hover"),e.vakata.context.settings.hide_onmouseleave&&(r=setTimeout(function(t){return function(){e.vakata.context.hide()}}(this),e.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(t){t.preventDefault(),!e(this).blur().parent().hasClass("vakata-context-disabled")&&e.vakata.context._execute(e(this).attr("rel"))!==!1&&e.vakata.context.hide()}).on("keydown","a",function(t){var r=null;switch(t.which){case 13:case 32:t.type="mouseup",t.preventDefault(),e(t.currentTarget).trigger(t);break;case 37:n.is_visible&&(n.element.find(".vakata-context-hover").last().parents("li:eq(0)").find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 38:n.is_visible&&(r=n.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first(),r.length||(r=n.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()),r.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 39:n.is_visible&&(n.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 40:n.is_visible&&(r=n.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first(),r.length||(r=n.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),r.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 27:e.vakata.context.hide(),t.preventDefault();break;default:}}).on("keydown",function(e){e.preventDefault();var t=n.element.find(".vakata-contextmenu-shortcut-"+e.which).parent();t.parent().not(".vakata-context-disabled")&&t.mouseup()}).appendTo("body"),e(document).on("mousedown",function(t){n.is_visible&&!e.contains(n.element[0],t.target)&&e.vakata.context.hide()}).on("context_show.vakata",function(e,r){n.element.find("li:has(ul)").children("a").addClass("vakata-context-parent"),t&&n.element.addClass("vakata-context-rtl").css("direction","rtl"),n.element.find("ul").hide().end()})})}(e),e.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0},e.jstree.plugins.dnd=function(t,n){this.bind=function(){n.bind.call(this),this.element.on("mousedown.jstree touchstart.jstree",".jstree-anchor",e.proxy(function(t){var n=this.get_node(t.target),r=this.is_selected(n)?this.get_selected().length:1;if(n&&n.id&&n.id!=="#"&&(t.which===1||t.type==="touchstart")&&(this.settings.dnd.is_draggable===!0||e.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,r>1?this.get_selected(!0):[n])))return this.element.trigger("mousedown.jstree"),e.vakata.dnd.start(t,{jstree:!0,origin:this,obj:this.get_node(n,!0),nodes:r>1?this.get_selected():[n.id]},'<div id="jstree-dnd" class="jstree-'+this.get_theme()+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+(r>1?r+" "+this.get_string("nodes"):this.get_text(t.currentTarget,!0))+'<ins class="jstree-copy" style="display:none;">+</ins></div>')},this))}},e(function(){var t=!1,n=!1,r=!1,i=e('<div id="jstree-marker">&#160;</div>').hide().appendTo("body");e(document).bind("dnd_start.vakata",function(e,n){t=!1}).bind("dnd_move.vakata",function(s,o){r&&clearTimeout(r);if(!o.data.jstree)return;if(o.event.target.id&&o.event.target.id==="jstree-marker")return;var u=e.jstree.reference(o.event.target),a=!1,f=!1,l=!1,c,h,p,d,v,m,g,y,b,w,E,S,x,T;if(u&&u._data&&u._data.dnd){i.attr("class","jstree-"+u.get_theme()+(u.settings.core.themes.responsive?" jstree-dnd-responsive":"")),o.helper.children().attr("class","jstree-"+u.get_theme()+(u.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy:eq(0)")[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"show":"hide"]();if(o.event.target!==u.element[0]&&o.event.target!==u.get_container_ul()[0]||u.get_container_ul().children().length!==0){a=e(o.event.target).closest(".jstree-anchor");if(a&&a.length&&a.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")){f=a.offset(),l=o.event.pageY-f.top,p=a.height(),l<p/3?m=["b","i","a"]:l>p-p/3?m=["a","i","b"]:m=l>p/2?["i","a","b"]:["i","b","a"],e.each(m,function(s,l){switch(l){case"b":c=f.left-6,h=f.top,d=u.get_parent(a),v=a.parent().index();break;case"i":x=u.settings.dnd.inside_pos,T=u.get_node(a.parent()),c=f.left-2,h=f.top+p/2+1,d=T.id,v=x==="first"?0:x==="last"?T.children.length:Math.min(x,T.children.length);break;case"a":c=f.left-6,h=f.top+p,d=u.get_parent(a),v=a.parent().index()+1}g=!0;for(y=0,b=o.data.nodes.length;y<b;y++){w=o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node",E=v,w==="move_node"&&l==="a"&&o.data.origin&&o.data.origin===u&&d===u.get_parent(o.data.nodes[y])&&(S=u.get_node(d),E>e.inArray(o.data.nodes[y],S.children)&&(E-=1)),g=g&&(u&&u.settings&&u.settings.dnd&&u.settings.dnd.check_while_dragging===!1||u.check(w,o.data.origin&&o.data.origin!==u?o.data.origin.get_node(o.data.nodes[y]):o.data.nodes[y],d,E,{dnd:!0,ref:u.get_node(a.parent()),pos:l,is_multi:o.data.origin&&o.data.origin!==u,is_foreign:!o.data.origin}));if(!g){u&&u.last_error&&(n=u.last_error());break}}if(g)return l==="i"&&a.parent().is(".jstree-closed")&&u.settings.dnd.open_timeout&&(r=setTimeout(function(e,t){return function(){e.open_node(t)}}(u,a),u.settings.dnd.open_timeout)),t={ins:u,par:d,pos:l==="i"&&x==="last"&&v===0&&!u.is_loaded(T)?"last":v},i.css({left:c+"px",top:h+"px"}).show(),o.helper.find(".jstree-icon:eq(0)").removeClass("jstree-er").addClass("jstree-ok"),n={},m=!0,!1});if(m===!0)return}}else{g=!0;for(y=0,b=o.data.nodes.length;y<b;y++){g=g&&u.check(o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node",o.data.origin&&o.data.origin!==u?o.data.origin.get_node(o.data.nodes[y]):o.data.nodes[y],"#","last",{dnd:!0,ref:u.get_node("#"),pos:"i",is_multi:o.data.origin&&o.data.origin!==u,is_foreign:!o.data.origin});if(!g)break}if(g){t={ins:u,par:"#",pos:"last"},i.hide(),o.helper.find(".jstree-icon:eq(0)").removeClass("jstree-er").addClass("jstree-ok");return}}}t=!1,o.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er"),i.hide()}).bind("dnd_scroll.vakata",function(e,n){if(!n.data.jstree)return;i.hide(),t=!1,n.helper.find(".jstree-icon:eq(0)").removeClass("jstree-ok").addClass("jstree-er")}).bind("dnd_stop.vakata",function(s,o){r&&clearTimeout(r);if(!o.data.jstree)return;i.hide();var u,a,f=[];if(t){for(u=0,a=o.data.nodes.length;u<a;u++)f[u]=o.data.origin?o.data.origin.get_node(o.data.nodes[u]):o.data.nodes[u],o.data.origin&&(f[u].instance=o.data.origin);t.ins[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node"](f,t.par,t.pos)}else u=e(o.event.target).closest(".jstree"),u.length&&n&&n.error&&n.error==="check"&&(u=u.jstree(!0),u&&u.settings.core.error.call(this,n))}).bind("keyup keydown",function(t,n){n=e.vakata.dnd._get(),n.data&&n.data.jstree&&n.helper.find(".jstree-copy:eq(0)")[n.data.origin&&(n.data.origin.settings.dnd.always_copy||n.data.origin.settings.dnd.copy&&(t.metaKey||t.ctrlKey))?"show":"hide"]()})}),function(e){var t={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1};e.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:50},_trigger:function(t,n){var r=e.vakata.dnd._get();r.event=n,e(document).triggerHandler("dnd_"+t+".vakata",r)},_get:function(){return{data:t.data,element:t.element,helper:t.helper}},_clean:function(){t.helper&&t.helper.remove(),t.scroll_i&&(clearInterval(t.scroll_i),t.scroll_i=!1),t={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1},e(document).off("mousemove touchmove",e.vakata.dnd.drag),e(document).off("mouseup touchend",e.vakata.dnd.stop)},_scroll:function(n){if(!t.scroll_e||!t.scroll_l&&!t.scroll_t)return t.scroll_i&&(clearInterval(t.scroll_i),t.scroll_i=!1),!1;if(!t.scroll_i)return t.scroll_i=setInterval(e.vakata.dnd._scroll,100),!1;if(n===!0)return!1;var r=t.scroll_e.scrollTop(),i=t.scroll_e.scrollLeft();t.scroll_e.scrollTop(r+t.scroll_t*e.vakata.dnd.settings.scroll_speed),t.scroll_e.scrollLeft(i+t.scroll_l*e.vakata.dnd.settings.scroll_speed),(r!==t.scroll_e.scrollTop()||i!==t.scroll_e.scrollLeft())&&e.vakata.dnd._trigger("scroll",t.scroll_e)},start:function(n,r,i){n.type==="touchstart"&&n.originalEvent&&n.originalEvent.changedTouches&&n.originalEvent.changedTouches[0]&&(n.pageX=n.originalEvent.changedTouches[0].pageX,n.pageY=n.originalEvent.changedTouches[0].pageY,n.target=document.elementFromPoint(n.originalEvent.changedTouches[0].pageX-window.pageXOffset,n.originalEvent.changedTouches[0].pageY-window.pageYOffset)),t.is_drag&&e.vakata.dnd.stop({});try{n.currentTarget.unselectable="on",n.currentTarget.onselectstart=function(){return!1},n.currentTarget.style&&(n.currentTarget.style.MozUserSelect="none")}catch(s){}return t.init_x=n.pageX,t.init_y=n.pageY,t.data=r,t.is_down=!0,t.element=n.currentTarget,t.target=n.target,t.is_touch=n.type==="touchstart",i!==!1&&(t.helper=e("<div id='vakata-dnd'></div>").html(i).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"})),e(document).bind("mousemove touchmove",e.vakata.dnd.drag),e(document).bind("mouseup touchend",e.vakata.dnd.stop),!1},drag:function(n){n.type==="touchmove"&&n.originalEvent&&n.originalEvent.changedTouches&&n.originalEvent.changedTouches[0]&&(n.pageX=n.originalEvent.changedTouches[0].pageX,n.pageY=n.originalEvent.changedTouches[0].pageY,n.target=document.elementFromPoint(n.originalEvent.changedTouches[0].pageX-window.pageXOffset,n.originalEvent.changedTouches[0].pageY-window.pageYOffset));if(!t.is_down)return;if(!t.is_drag){if(!(Math.abs(n.pageX-t.init_x)>(t.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)||Math.abs(n.pageY-t.init_y)>(t.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)))return;t.helper&&(t.helper.appendTo("body"),t.helper_w=t.helper.outerWidth()),t.is_drag=!0,e.vakata.dnd._trigger("start",n)}var r=!1,i=!1,s=!1,o=!1,u=!1,a=!1,f=!1,l=!1,c=!1,h=!1;t.scroll_t=0,t.scroll_l=0,t.scroll_e=!1,e(e(n.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(e(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var r=e(this),i=r.offset();this.scrollHeight>this.offsetHeight&&(i.top+r.height()-n.pageY<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=1),n.pageY-i.top<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=-1)),this.scrollWidth>this.offsetWidth&&(i.left+r.width()-n.pageX<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=1),n.pageX-i.left<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=-1));if(t.scroll_t||t.scroll_l)return t.scroll_e=e(this),!1});if(!t.scroll_e){r=e(document),i=e(window),s=r.height(),o=i.height(),u=r.width(),a=i.width(),f=r.scrollTop(),l=r.scrollLeft(),s>o&&n.pageY-f<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=-1),s>o&&o-(n.pageY-f)<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=1),u>a&&n.pageX-l<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=-1),u>a&&a-(n.pageX-l)<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=1);if(t.scroll_t||t.scroll_l)t.scroll_e=r}return t.scroll_e&&e.vakata.dnd._scroll(!0),t.helper&&(c=parseInt(n.pageY+e.vakata.dnd.settings.helper_top,10),h=parseInt(n.pageX+e.vakata.dnd.settings.helper_left,10),s&&c+25>s&&(c=s-50),u&&h+t.helper_w>u&&(h=u-(t.helper_w+2)),t.helper.css({left:h+"px",top:c+"px"})),e.vakata.dnd._trigger("move",n),!1},stop:function(n){n.type==="touchend"&&n.originalEvent&&n.originalEvent.changedTouches&&n.originalEvent.changedTouches[0]&&(n.pageX=n.originalEvent.changedTouches[0].pageX,n.pageY=n.originalEvent.changedTouches[0].pageY,n.target=document.elementFromPoint(n.originalEvent.changedTouches[0].pageX-window.pageXOffset,n.originalEvent.changedTouches[0].pageY-window.pageYOffset));if(t.is_drag)e.vakata.dnd._trigger("stop",n);else if(n.type==="touchend"&&n.target===t.target){var r=setTimeout(function(){e(n.target).click()},100);e(n.target).one("click",function(){r&&clearTimeout(r)})}return e.vakata.dnd._clean(),!1}}}(jQuery),e.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1},e.jstree.plugins.search=function(t,n){this.bind=function(){n.bind.call(this),this._data.search.str="",this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this.element.on("before_open.jstree",e.proxy(function(t,n){var r,i,s,o=this._data.search.res,u=[],a=e();if(o&&o.length){this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(o,function(t){return"0123456789".indexOf(t[0])!==-1?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.dom.children(".jstree-anchor").addClass("jstree-search");if(this.settings.search.show_only_matches&&this._data.search.res.length){for(r=0,i=o.length;r<i;r++)u=u.concat(this.get_node(o[r]).parents);u=e.vakata.array_remove_item(e.vakata.array_unique(u),"#"),a=u.length?e(this.element[0].querySelectorAll("#"+e.map(u,function(t){return"0123456789".indexOf(t[0])!==-1?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))):e(),this.element.find(".jstree-node").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last"),a=a.add(this._data.search.dom),a.parentsUntil(".jstree").addBack().show().filter(".jstree-children").each(function(){e(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last")})}}},this)),this.settings.search.show_only_matches&&this.element.on("search.jstree",function(t,n){n.nodes.length&&(e(this).find(".jstree-node").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last"),n.nodes.parentsUntil(".jstree").addBack().show().filter(".jstree-children").each(function(){e(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last")}))}).on("clear_search.jstree",function(t,n){n.nodes.length&&e(this).find(".jstree-node").css("display","").filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last")})},this.search=function(t,n){if(t===!1||e.trim(t.toString())==="")return this.clear_search();t=t.toString();var r=this.settings.search,i=r.ajax?r.ajax:!1,s=null,o=[],u=[],a,f;this._data.search.res.length&&this.clear_search();if(!n&&i!==!1)return e.isFunction(i)?i.call(this,t,e.proxy(function(n){n&&n.d&&(n=n.d),this._load_nodes(e.isArray(n)?e.vakata.array_unique(n):[],function(){this.search(t,!0)},!0)},this)):(i=e.extend({},i),i.data||(i.data={}),i.data.str=t,e.ajax(i).fail(e.proxy(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(i)},this.settings.core.error.call(this,this._data.core.last_error)},this)).done(e.proxy(function(n){n&&n.d&&(n=n.d),this._load_nodes(e.isArray(n)?e.vakata.array_unique(n):[],function(){this.search(t,!0)},!0)},this)));this._data.search.str=t,this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],s=new e.vakata.search(t,!0,{caseSensitive:r.case_sensitive,fuzzy:r.fuzzy}),e.each(this._model.data,function(e,n){n.text&&(r.search_callback&&r.search_callback.call(this,t,n)||!r.search_callback&&s.search(n.text).isMatch)&&(!r.search_leaves_only||n.state.loaded&&n.children.length===0)&&(o.push(e),u=u.concat(n.parents))}),o.length&&(u=e.vakata.array_unique(u),this._search_open(u),this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(o,function(t){return"0123456789".indexOf(t[0])!==-1?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.res=o,this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")),this.trigger("search",{nodes:this._data.search.dom,str:t,res:this._data.search.res})},this.clear_search=function(){this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search"),this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0),this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res}),this._data.search.str="",this._data.search.res=[],this._data.search.opn=[],this._data.search.dom=e()},this._search_open=function(t){var n=this;e.each(t.concat([]),function(r,i){if(i==="#")return!0;try{i=e("#"+i.replace(e.jstree.idregex,"\\$&"),n.element)}catch(s){}i&&i.length&&n.is_closed(i)&&(n._data.search.opn.push(i[0].id),n.open_node(i,function(){n._search_open(t)},0))})}},function(e){e.vakata.search=function(e,t,n){n=n||{},n.fuzzy!==!1&&(n.fuzzy=!0),e=n.caseSensitive?e:e.toLowerCase();var r=n.location||0,i=n.distance||100,s=n.threshold||.6,o=e.length,u,a,f,l;return o>32&&(n.fuzzy=!1),n.fuzzy&&(u=1<<o-1,a=function(){var t={},n=0;for(n=0;n<o;n++)t[e.charAt(n)]=0;for(n=0;n<o;n++)t[e.charAt(n)]|=1<<o-n-1;return t}(),f=function(e,t){var n=e/o,s=Math.abs(r-t);return i?n+s/i:s?1:n}),l=function(t){t=n.caseSensitive?t:t.toLowerCase();if(e===t||t.indexOf(e)!==-1)return{isMatch:!0,score:0};if(!n.fuzzy)return{isMatch:!1,score:1};var i,l,c=t.length,h=s,p=t.indexOf(e,r),d,v,m=o+c,g,y,b,w,E,S=1,x=[];p!==-1&&(h=Math.min(f(0,p),h),p=t.lastIndexOf(e,r+o),p!==-1&&(h=Math.min(f(0,p),h))),p=-1;for(i=0;i<o;i++){d=0,v=m;while(d<v)f(i,r+v)<=h?d=v:m=v,v=Math.floor((m-d)/2+d);m=v,y=Math.max(1,r-v+1),b=Math.min(r+v,c)+o,w=new Array(b+2),w[b+1]=(1<<i)-1;for(l=b;l>=y;l--){E=a[t.charAt(l-1)],i===0?w[l]=(w[l+1]<<1|1)&E:w[l]=(w[l+1]<<1|1)&E|((g[l+1]|g[l])<<1|1)|g[l+1];if(w[l]&u){S=f(i,l-1);if(S<=h){h=S,p=l-1,x.push(p);if(!(p>r))break;y=Math.max(1,2*r-p)}}}if(f(i+1,r)>h)break;g=w}return{isMatch:p>=0,score:S}},t===!0?{search:l}:l(t)}}(jQuery),e.jstree.defaults.sort=function(e,t){return this.get_text(e)>this.get_text(t)?1:-1},e.jstree.plugins.sort=function(t,n){this.bind=function(){n.bind.call(this),this.element.on("model.jstree",e.proxy(function(e,t){this.sort(t.parent,!0)},this)).on("rename_node.jstree create_node.jstree",e.proxy(function(e,t){this.sort(t.parent||t.node.parent,!1),this.redraw_node(t.parent||t.node.parent,!0)},this)).on("move_node.jstree copy_node.jstree",e.proxy(function(e,t){this.sort(t.parent,!1),this.redraw_node(t.parent,!0)},this))},this.sort=function(t,n){var r,i;t=this.get_node(t);if(t&&t.children&&t.children.length){t.children.sort(e.proxy(this.settings.sort,this));if(n)for(r=0,i=t.children_d.length;r<i;r++)this.sort(t.children_d[r],!1)}}};var p=!1;e.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree",ttl:!1,filter:!1},e.jstree.plugins.state=function(t,n){this.bind=function(){n.bind.call(this);var t=e.proxy(function(){this.element.on(this.settings.state.events,e.proxy(function(){p&&clearTimeout(p),p=setTimeout(e.proxy(function(){this.save_state()},this),100)},this))},this);this.element.on("ready.jstree",e.proxy(function(e,n){this.element.one("restore_state.jstree",t),this.restore_state()||t()},this))},this.save_state=function(){var t={state:this.get_state(),ttl:this.settings.state.ttl,sec:+(new Date)};e.vakata.storage.set(this.settings.state.key,JSON.stringify(t))},this.restore_state=function(){var t=e.vakata.storage.get(this.settings.state.key);if(!!t)try{t=JSON.parse(t)}catch(n){return!1}return!!t&&t.ttl&&t.sec&&+(new Date)-t.sec>t.ttl?!1:(!!t&&t.state&&(t=t.state),!!t&&e.isFunction(this.settings.state.filter)&&(t=this.settings.state.filter.call(this,t)),t?(this.element.one("set_state.jstree",function(n,r){r.instance.trigger("restore_state",{state:e.extend(!0,{},t)})}),this.set_state(t),!0):!1)},this.clear_state=function(){return e.vakata.storage.del(this.settings.state.key)}},function(e,t){e.vakata.storage={set:function(e,t){return window.localStorage.setItem(e,t)},get:function(e){return window.localStorage.getItem(e)},del:function(e){return window.localStorage.removeItem(e)}}}(jQuery),e.jstree.defaults.types={"#":{},"default":{}},e.jstree.plugins.types=function(n,r){this.init=function(e,n){var i,s;if(n&&n.types&&n.types["default"])for(i in n.types)if(i!=="default"&&i!=="#"&&n.types.hasOwnProperty(i))for(s in n.types["default"])n.types["default"].hasOwnProperty(s)&&n.types[i][s]===t&&(n.types[i][s]=n.types["default"][s]);r.init.call(this,e,n),this._model.data["#"].type="#"},this.refresh=function(e){r.refresh.call(this,e),this._model.data["#"].type="#"},this.bind=function(){this.element.on("model.jstree",e.proxy(function(e,n){var r=this._model.data,i=n.nodes,s=this.settings.types,o,u,a="default";for(o=0,u=i.length;o<u;o++)a="default",r[i[o]].original&&r[i[o]].original.type&&s[r[i[o]].original.type]&&(a=r[i[o]].original.type),r[i[o]].data&&r[i[o]].data.jstree&&r[i[o]].data.jstree.type&&s[r[i[o]].data.jstree.type]&&(a=r[i[o]].data.jstree.type),r[i[o]].type=a,r[i[o]].icon===!0&&s[a].icon!==t&&(r[i[o]].icon=s[a].icon);r["#"].type="#"},this)),r.bind.call(this)},this.get_json=function(t,n,i){var s,o,u=this._model.data,a=n?e.extend(!0,{},n,{no_id:!1}):{},f=r.get_json.call(this,t,a,i);if(f===!1)return!1;if(e.isArray(f))for(s=0,o=f.length;s<o;s++)f[s].type=f[s].id&&u[f[s].id]&&u[f[s].id].type?u[f[s].id].type:"default",n&&n.no_id&&(delete f[s].id,f[s].li_attr&&f[s].li_attr.id&&delete f[s].li_attr.id);else f.type=f.id&&u[f.id]&&u[f.id].type?u[f.id].type:"default",n&&n.no_id&&(f=this._delete_ids(f));return f},this._delete_ids=function(t){if(e.isArray(t)){for(var n=0,r=t.length;n<r;n++)t[n]=this._delete_ids(t[n]);return t}return delete t.id,t.li_attr&&t.li_attr.id&&delete t.li_attr.id,t.children&&e.isArray(t.children)&&(t.children=this._delete_ids(t.children)),t},this.check=function(n,i,s,o,u){if(r.check.call(this,n,i,s,o,u)===!1)return!1;i=i&&i.id?i:this.get_node(i),s=s&&s.id?s:this.get_node(s);var a=i&&i.id?e.jstree.reference(i.id):null,f,l,c,h;a=a&&a._model&&a._model.data?a._model.data:null;switch(n){case"create_node":case"move_node":case"copy_node":if(n!=="move_node"||e.inArray(i.id,s.children)===-1){f=this.get_rules(s);if(f.max_children!==t&&f.max_children!==-1&&f.max_children===s.children.length)return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+n,data:JSON.stringify({chk:n,pos:o,obj:i&&i.id?i.id:!1,par:s&&s.id?s.id:!1})},!1;if(f.valid_children!==t&&f.valid_children!==-1&&e.inArray(i.type,f.valid_children)===-1)return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+n,data:JSON.stringify({chk:n,pos:o,obj:i&&i.id?i.id:!1,par:s&&s.id?s.id:!1})},!1;if(a&&i.children_d&&i.parents){l=0;for(c=0,h=i.children_d.length;c<h;c++)l=Math.max(l,a[i.children_d[c]].parents.length);l=l-i.parents.length+1}if(l<=0||l===t)l=1;do{if(f.max_depth!==t&&f.max_depth!==-1&&f.max_depth<l)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+n,data:JSON.stringify({chk:n,pos:o,obj:i&&i.id?i.id:!1,par:s&&s.id?s.id:!1})},!1;s=this.get_node(s.parent),f=this.get_rules(s),l++}while(s)}}return!0},this.get_rules=function(e){e=this.get_node(e);if(!e)return!1;var n=this.get_type(e,!0);return n.max_depth===t&&(n.max_depth=-1),n.max_children===t&&(n.max_children=-1),n.valid_children===t&&(n.valid_children=-1),n},this.get_type=function(t,n){return t=this.get_node(t),t?n?e.extend({type:t.type},this.settings.types[t.type]):t.type:!1},this.set_type=function(n,r){var i,s,o,u,a;if(e.isArray(n)){n=n.slice();for(s=0,o=n.length;s<o;s++)this.set_type(n[s],r);return!0}return i=this.settings.types,n=this.get_node(n),!i[r]||!n?!1:(u=n.type,a=this.get_icon(n),n.type=r,(a===!0||i[u]&&i[u].icon&&a===i[u].icon)&&this.set_icon(n,i[r].icon!==t?i[r].icon:!0),!0)}},e.jstree.defaults.unique={case_sensitive:!1,duplicate:function(e,t){return e+" ("+t+")"}},e.jstree.plugins.unique=function(n,r){this.check=function(t,n,i,s,o){if(r.check.call(this,t,n,i,s,o)===!1)return!1;n=n&&n.id?n:this.get_node(n),i=i&&i.id?i:this.get_node(i);if(!i||!i.children)return!0;var u=t==="rename_node"?s:n.text,a=[],f=this.settings.unique.case_sensitive,l=this._model.data,c,h;for(c=0,h=i.children.length;c<h;c++)a.push(f?l[i.children[c]].text:l[i.children[c]].text.toLowerCase());f||(u=u.toLowerCase());switch(t){case"delete_node":return!0;case"rename_node":return c=e.inArray(u,a)===-1||n.text&&n.text===u,c||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+u+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:s,obj:n&&n.id?n.id:!1,par:i&&i.id?i.id:!1})}),c;case"create_node":return c=e.inArray(u,a)===-1,c||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+u+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:s,obj:n&&n.id?n.id:!1,par:i&&i.id?i.id:!1})}),c;case"copy_node":return c=e.inArray(u,a)===-1,c||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+u+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:s,obj:n&&n.id?n.id:!1,par:i&&i.id?i.id:!1})}),c;case"move_node":return c=n.parent===i.id||e.inArray(u,a)===-1,c||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+u+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:s,obj:n&&n.id?n.id:!1,par:i&&i.id?i.id:!1})}),c}return!0},this.create_node=function(n,i,s,o,u){if(!i||i.text===t){n===null&&(n="#"),n=this.get_node(n);if(!n)return r.create_node.call(this,n,i,s,o,u);s=s===t?"last":s;if(!s.toString().match(/^(before|after)$/)&&!u&&!this.is_loaded(n))return r.create_node.call(this,n,i,s,o,u);i||(i={});var a,f,l,c,h,p=this._model.data,d=this.settings.unique.case_sensitive,v=this.settings.unique.duplicate;f=a=this.get_string("New node"),l=[];for(c=0,h=n.children.length;c<h;c++)l.push(d?p[n.children[c]].text:p[n.children[c]].text.toLowerCase());c=1;while(e.inArray(d?f:f.toLowerCase(),l)!==-1)f=v.call(this,a,++c).toString();i.text=f}return r.create_node.call(this,n,i,s,o,u)}};var d=document.createElement("DIV");d.setAttribute("unselectable","on"),d.className="jstree-wholerow",d.innerHTML="&#160;",e.jstree.plugins.wholerow=function(t,n){this.bind=function(){n.bind.call(this),this.element.on("ready.jstree set_state.jstree",e.proxy(function(){this.hide_dots()},this)).on("init.jstree loading.jstree ready.jstree",e.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var n=!1,r,i;for(r=0,i=t.selected.length;r<i;r++)n=this.get_node(t.selected[r],!0),n&&n.length&&n.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("open_node.jstree",e.proxy(function(e,t){this.get_node(t.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("hover_node.jstree dehover_node.jstree",e.proxy(function(e,t){this.get_node(t.node,!0).children(".jstree-wholerow")[e.type==="hover_node"?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",e.proxy(function(t){t.preventDefault();var n=e.Event("contextmenu",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,pageX:t.pageX,pageY:t.pageY});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor:eq(0)").trigger(n)},this)).on("click.jstree",".jstree-wholerow",function(t){t.stopImmediatePropagation();var n=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor:eq(0)").trigger(n).focus()}).on("click.jstree",".jstree-leaf > .jstree-ocl",e.proxy(function(t){t.stopImmediatePropagation();var n=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor:eq(0)").trigger(n).focus()},this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",e.proxy(function(e){return e.stopImmediatePropagation(),this.hover_node(e.currentTarget),!1},this)).on("mouseleave.jstree",".jstree-node",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove(),n.teardown.call(this)},this.redraw_node=function(t,r,i){t=n.redraw_node.call(this,t,r,i);if(t){var s=d.cloneNode(!0);e.inArray(t.id,this._data.core.selected)!==-1&&(s.className+=" jstree-wholerow-clicked"),t.insertBefore(s,t.childNodes[0])}return t}}}),define("renderers/chart",["jstree"],function(){return{render:function(e){return $("<div>").jstree({core:{data:e}})}}});